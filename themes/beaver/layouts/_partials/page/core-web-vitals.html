{{ if and (not hugo.IsServer) (site.Params.performanceMonitoring) }}
<script>
// LCP - Largest Contentful Paint tracking
new PerformanceObserver((entryList) => {
  for (const entry of entryList.getEntries()) {
    console.log('LCP:', entry.startTime);
    if (typeof gtag !== 'undefined') {
      gtag('event', 'web_vitals', {
        name: 'LCP',
        value: Math.round(entry.startTime),
        event_category: 'Web Vitals'
      });
    }
  }
}).observe({entryTypes: ['largest-contentful-paint']});

// CLS - Cumulative Layout Shift tracking
let clsValue = 0;
new PerformanceObserver((entryList) => {
  for (const entry of entryList.getEntries()) {
    if (!entry.hadRecentInput) {
      clsValue += entry.value;
      console.log('CLS:', clsValue);
      if (typeof gtag !== 'undefined') {
        gtag('event', 'web_vitals', {
          name: 'CLS',
          value: Math.round(clsValue * 1000),
          event_category: 'Web Vitals'
        });
      }
    }
  }
}).observe({entryTypes: ['layout-shift']});

// Error tracking
window.addEventListener('error', (event) => {
  if (typeof gtag !== 'undefined') {
    gtag('event', 'exception', {
      description: event.message,
      fatal: false
    });
  }
});
</script>
{{ end }}