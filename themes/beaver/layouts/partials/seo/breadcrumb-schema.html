{{/* Breadcrumb Schema - JSON-LD structured data for navigation */}}
{{ $breadcrumbs := slice }}
{{ $baseURL := .Site.BaseURL }}

{{/* Always include Home */}}
{{ $breadcrumbs = $breadcrumbs | append (dict "name" "Home" "url" $baseURL "position" 1) }}

{{/* Section name mapping for consistent titles */}}
{{- $sectionNames := dict
  "blog" "Blog"
  "services" "Services"
  "use-cases" "Use Cases"
  "clients" "Clients"
-}}

{{/* Build breadcrumb path based on page structure */}}
{{ $position := 2 }}

{{ if ne .Type "homepage" }}
  {{ if and .Section (ne .Section "") }}
    {{/* Get section display name */}}
    {{ $sectionName := index $sectionNames .Section | default (.Section | title) }}
    {{ $sectionURL := printf "%s%s/" $baseURL .Section }}

    {{/* Add section breadcrumb */}}
    {{ $breadcrumbs = $breadcrumbs | append (dict "name" $sectionName "url" $sectionURL "position" $position) }}

    {{/* Add page breadcrumb if this is an individual page */}}
    {{ if eq .Kind "page" }}
      {{ $position = add $position 1 }}
      {{ $breadcrumbs = $breadcrumbs | append (dict "name" .Title "url" .Permalink "position" $position) }}
    {{ end }}
  {{ else if eq .Kind "page" }}
    {{/* Top-level pages */}}
    {{ $breadcrumbs = $breadcrumbs | append (dict "name" .Title "url" .Permalink "position" $position) }}
  {{ end }}
{{ end }}

{{/* Only render if there are more than 1 breadcrumb items */}}
{{ if gt (len $breadcrumbs) 1 }}
{{/* Build itemListElement as Go slice of maps for proper JSON escaping */}}
{{ $itemListElement := slice }}
{{ range $crumb := $breadcrumbs }}
  {{ $item := dict "@type" "ListItem" "position" $crumb.position "name" $crumb.name "item" $crumb.url }}
  {{ $itemListElement = $itemListElement | append $item }}
{{ end }}

{{ $schema := dict "@context" "https://schema.org" "@type" "BreadcrumbList" "itemListElement" $itemListElement }}
<script type="application/ld+json">
{{ $schema | jsonify | safeJS }}
</script>
{{ end }}
