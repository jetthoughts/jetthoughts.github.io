#!/usr/bin/env sh

set -euo pipefail

# Set Docker platform for ARM-based Macs (M1/M2 chips)
if [ "$(uname -s)" = "Darwin" ]; then
  case "$(uname -m)" in
    arm*)
      export DOCKER_DEFAULT_PLATFORM=linux/arm64/v8
      ;;
  esac
fi

echo "Running docker compose with project name: ${DOCKED_PROJECT_NAME:-jtcom}"
pwd

export DOCKER_BUILDKIT=1
export COMPOSE_DOCKER_CLI_BUILD=1

docker "compose" \
  -f ".dev/compose.yml" \
  -p "${DOCKED_PROJECT_NAME:-jtcom}" \
  "$@"
