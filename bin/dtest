#!/usr/bin/env bash

set -euo pipefail

echo "Building Hugo site for Docker tests (public-dtest) with optimizations..."
hugo --noBuildLock \
   --buildDrafts \
   --environment test \
   --gc \
   --destination=_dest/public-dtest \
   --logLevel=warn \
   --baseURL="http://localhost:1314"

# Now run the tests in Docker
echo "Running tests in Docker..."
bin/docked --env PRECOMPILED_ASSETS=true --env TEST_SERVER_PORT=1314 t "$@"
