#!/usr/bin/env bash

set -euo pipefail

HUGO_DEFAULT_PATH=${HUGO_DEFAULT_PATH:-"_dest/public-dtest"}

HUGO_NUMWORKERMULTIPLIER=16 hugo --noBuildLock \
   --buildDrafts \
   --environment test \
   --gc \
   --destination="${HUGO_DEFAULT_PATH}" \
   --logLevel=error \
   --baseURL="/"

# Now run the tests in Docker
bin/docked --env PRECOMPILED_ASSETS=true --env HUGO_DEFAULT_PATH="${HUGO_DEFAULT_PATH}" t "$@"
