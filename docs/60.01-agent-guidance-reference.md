# JT Site Agent Guidance Reference

**CRITICAL: ALL AGENTS MUST READ THIS BEFORE PROJECT WORK**

## üìö Handbook System Overview

This project uses a modular handbook approach to organize comprehensive development guidelines. Instead of a massive CLAUDE.md file, functionality is distributed across specialized handbooks:

### üóÇÔ∏è Handbook Structure (Johnny Decimal + Di√°taxis)

- **25.01** - Retrospective Framework - *reference*
- **25.02** - Failure Pattern Library - *reference*
- **25.03** - Retrospective Recording Guide - *how-to*
- **60.01** - Agent Guidance Reference (this file) - *reference*
- **60.02** - Agile Sprint Framework - *how-to*
- **60.03** - TDD Quality Standards - *reference*
- **60.04** - Four-Eyes Enforcement - *how-to*
- **60.05** - Knowledge Management - *reference*

## üéØ Quick Reference for Agents

### Resource Organization

**Knowledge Base**: `/knowledge/` - Company-wide practices, patterns, solutions
**Project Docs**: `docs/` - Project-specific handbooks and architectural decisions
**Templates**: Available in both knowledge base and project docs

#### Project-Specific Resource Locations

**Content Templates**: `docs/70-79-templates-boilerplates/` (70.xx series)
**SEO Resources**: `docs/90-99-content-strategy/seo-optimization/` (90.xx series)

‚úÖ **These are PROJECT-SPECIFIC resources and belong in `docs/` using Johnny Decimal + Di√°taxis structure**

#### Available Project Resources

- **Content Templates**: Located in `docs/70-79-templates-boilerplates/`
- **Content Strategy**: Templates organized in `docs/90-99-content-strategy/templates-library/`
- **SEO Resources**: Organized in `docs/90-99-content-strategy/seo-optimization/`
- **Emergency CTO SEO**: `90.09-emergency-cto-seo-audit-reference.md`

See the [Documentation Index](./DOCUMENTATION_INDEX.md) for current structure.
See the [Content Strategy documentation](./90-99-content-strategy/README.md) for all SEO resources.

### Critical Requirements

1. **Always Read Handbooks First**: Consult relevant handbooks before starting work
2. **Follow Johnny Decimal**: Use structured naming for all documentation
3. **Apply Di√°taxis**: Classify content as tutorial, how-to, explanation, or reference
4. **Use claude-context**: Primary search tool for existing patterns
5. **Coordinate via Memory**: Use claude-flow hooks for agent coordination
6. **Mandatory Retrospective Participation**: Participate in retrospective sessions when triggered

### Search Strategy (MANDATORY)

**Primary**: `claude-context search "[topic]" --path "." --limit 15`
**Secondary**: `context7 get-library-docs "[framework]" --topic "[specific-topic]"`
**Validation**: Check knowledge base practices and project handbooks

### Quality Standards

- **Zero-Defect Policy**: 100% functional correctness required
- **Four-Eyes Principle**: Paired agents for all critical changes
- **TDD Methodology**: Test-driven development with proper coverage
- **Security-First**: Apply security practices from knowledge base

## üöÄ Agent Execution Pattern

### Correct Agent Coordination

```javascript
// Single message with all related operations
[Parallel Agent Execution]:
  Task("Research agent", "Analyze using claude-context + handbooks", "researcher")
  Task("Coder agent", "Implement with TDD from 60.03 handbook", "coder")
  Task("Reviewer agent", "Review using quality standards from handbooks", "reviewer")

  // Batch all todos
  TodoWrite { todos: [...5-10 todos...] }

  // All file operations together
  Read, Write, Edit operations in single message
```

### Memory Coordination Pattern

```bash
# Before work
npx claude-flow@alpha hooks pre-task --description "[task]"

# During work
npx claude-flow@alpha hooks pre-edit --file "[file]" --auto-assign-agents true

# After work
npx claude-flow@alpha hooks post-edit --file "[file]" --format true
npx claude-flow@alpha hooks post-task --task-id "[task]"
```

## üìã Handler References

For detailed implementation guidelines, consult these handbooks:

- **Retrospective Framework**: See `docs/25.01-retrospective-framework-reference.md`
- **Failure Pattern Recognition**: See `docs/25.02-failure-pattern-library-reference.md`
- **Retrospective Recording**: See `docs/25.03-retrospective-recording-how-to.md`
- **Agile Development**: See `docs/60.02-agile-sprint-framework.md`
- **Testing & Quality**: See `docs/60.03-tdd-quality-standards.md`
- **Code Review Process**: See `docs/60.04-four-eyes-enforcement.md`
- **Documentation Standards**: See `docs/60.05-knowledge-management.md`

## üìù Project-Specific Agent Instructions

### Before Creating ANY Content

1. **ALWAYS check** the [Documentation Index](./DOCUMENTATION_INDEX.md) for current structure
2. **ALWAYS check** `docs/90-99-content-strategy/README.md` for content strategy guidance
3. **ALWAYS use** appropriate Johnny Decimal + Di√°taxis naming conventions
4. **NEVER create similar files** in `knowledge/` folder

### When Writing Service Pages

1. **USE** `docs/templates/70.01-service-page-template-reference.md`
2. **FOLLOW** the exact structure provided
3. **INCLUDE** all SEO elements specified

### When Optimizing for SEO

1. **REFERENCE** `docs/seo/80.01-fractional-cto-optimization-reference.md`
2. **IMPLEMENT** all technical requirements
3. **VALIDATE** against SEO checklists

### When Creating FAQs

1. **USE** `docs/templates/70.02-fractional-cto-faq-template-reference.md`
2. **ENSURE** schema markup compatibility
3. **FOLLOW** question structuring guidelines

### File Naming Convention (Johnny Decimal System)

**Template Categories**:
- **70.xx** = Content Templates
- **80.xx** = SEO Resources
- **90.xx** = Content Strategy

**Format**: `XX.YY-descriptive-name-content-type.md`

**Content Types** (Di√°taxis):
- `-reference.md` = Reference materials
- `-tutorial.md` = Step-by-step guides
- `-how-to.md` = Problem-solving guides
- `-explanation.md` = Conceptual background

### Enhanced Search Commands

```bash
# Index documentation for searching
claude-context index_codebase --path "docs/"
claude-context index_codebase --path "knowledge/"

# Search for specific content
claude-context search_code --query "template" --path "docs/"
claude-context search_code --query "TDD practices" --path "knowledge/"
```

## üîç Common Patterns

### Hugo/Jekyll Development (jt_site specific)
- Always use package-search MCP for external dependencies
- Verify existing components before creating new ones
- Follow Hugo shortcode and partial patterns
- Test templates with sample content
- Use `bun run test:build` for comprehensive production validation:
  - Production rendering verification with cache bypassing
  - Template metrics and performance analysis
  - Memory usage tracking and debugging output
  - Path warnings and unused template detection

### File Organization
- Source code: `src/`
- Tests: `tests/`
- Documentation: `docs/`
- Configuration: `config/`
- Temporary files: `_playground/YYYYMMDD_filename`

### Anti-Duplication Rules
- NEVER create files with suffixes like `_refactored`, `_new`, `_v2`
- ALWAYS use Edit/MultiEdit for existing files
- Search extensively before creating new content
- Consolidate similar functionality

## üîç Retrospective Integration (MANDATORY)

### Retrospective Trigger Conditions

**MANDATORY PARTICIPATION**: All agents must participate in retrospective sessions when triggered:

```yaml
retrospective_triggers:
  crisis_response_retrospective:
    - User reports system failures or degraded functionality
    - False success detection (success claims contradicted by evidence)
    - Methodology violations (TDD, Four-Eyes, Quality violations detected)
    - Test masking detection (skip(), excessive tolerance, output validation)

  routine_learning_retrospective:
    - Sprint completion or major milestone achievement
    - Quality concerns or declining metrics
    - Process improvement opportunities

  pattern_recognition_retrospective:
    - Recurring issues or emerging failure patterns
    - Multiple similar failures within timeframe
    - Quality degradation trends
```

### Agent Retrospective Responsibilities

#### Pre-Retrospective Preparation
```bash
# Check for failure patterns before task execution
retrospective_pattern_check() {
    # Search institutional memory for related patterns
    mcp__claude-flow__memory_usage --action search \
      --namespace "retrospective/patterns/failure" \
      --pattern "[current_task_domain]"

    # Apply relevant prevention mechanisms
    mcp__claude-flow__memory_usage --action search \
      --namespace "retrospective/prevention/mechanisms" \
      --pattern "[current_task_type]"
}
```

#### During Task Execution
- **Pattern Recognition**: Monitor for indicators from failure pattern library (25.02)
- **Prevention Activation**: Apply relevant prevention mechanisms automatically
- **Evidence Collection**: Maintain evidence for potential retrospective analysis
- **Quality Vigilance**: Monitor for quality degradation or methodology violations

#### Retrospective Session Participation
```yaml
agent_retrospective_participation:
  crisis_response:
    immediate_halt: "STOP all implementation work when crisis retrospective triggered"
    full_participation: "Participate in comprehensive crisis analysis"
    evidence_provision: "Provide complete evidence and context"
    learning_integration: "Integrate learning outcomes into behavioral patterns"

  routine_learning:
    scheduled_participation: "Participate in scheduled retrospective sessions"
    honest_assessment: "Provide honest assessment of processes and outcomes"
    improvement_commitment: "Commit to implementing learning outcomes"
    knowledge_sharing: "Share relevant experience and insights"

  pattern_recognition:
    pattern_validation: "Validate identified patterns from experience"
    prevention_development: "Contribute to prevention mechanism development"
    institutional_learning: "Support institutional learning integration"
    future_prevention: "Commit to applying prevention mechanisms"
```

### Memory Coordination for Retrospective Learning

#### Accessing Retrospective Knowledge
```bash
# Before starting any task, check retrospective memory
pre_task_retrospective_check() {
    echo "üîç Checking retrospective knowledge for task: $TASK"

    # Check for failure patterns related to current task
    mcp__claude-flow__memory_usage --action search \
      --namespace "retrospective/patterns/failure" \
      --pattern "$TASK_DOMAIN"

    # Check for successful prevention mechanisms
    mcp__claude-flow__memory_usage --action search \
      --namespace "retrospective/prevention/mechanisms" \
      --pattern "$TASK_TYPE"

    # Check for relevant learning outcomes
    mcp__claude-flow__memory_usage --action search \
      --namespace "retrospective/learning/outcomes" \
      --pattern "$TASK_CONTEXT"
}
```

#### Contributing to Retrospective Memory
```bash
# After task completion, contribute learning to retrospective memory
post_task_retrospective_contribution() {
    echo "üìö Contributing learning outcomes to retrospective memory"

    # Store task learning outcomes
    mcp__claude-flow__memory_usage --action store \
      --namespace "retrospective/learning/task_outcomes" \
      --key "$(date +%Y%m%d_%H%M%S)_${TASK_TYPE}" \
      --value "Task learning outcomes and insights"

    # Store any patterns observed
    if [[ "$PATTERNS_OBSERVED" ]]; then
        mcp__claude-flow__memory_usage --action store \
          --namespace "retrospective/patterns/observed" \
          --key "$(date +%Y%m%d_%H%M%S)_${PATTERN_TYPE}" \
          --value "Pattern observation and context"
    fi
}
```

### Sprint 2 Crisis Pattern Prevention

**CRITICAL**: All agents must be aware of and prevent Sprint 2 crisis patterns:

#### Test Masking Prevention (Zero Tolerance)
```yaml
test_masking_prevention:
  behavioral_constraint: "Behaviorally constrained against all forms of test masking"
  detection_triggers:
    - "skip() statements in test files"
    - "Tolerance values >5% without explicit justification"
    - "puts/print statements replacing assertions"
    - "TODO/FIXME comments in test code"

  immediate_response: "IMMEDIATE task termination on test masking detection"
  alternative_requirement: "ALWAYS implement working solutions, never mask failures"
```

#### Evidence-Based Success Validation (Mandatory)
```yaml
evidence_based_validation:
  success_claim_requirements:
    - "Build validation: Run bin/hugo-build and provide output"
    - "Test validation: Run bin/test and show all passing results"
    - "Visual validation: Provide screenshots for UI changes"
    - "Scope validation: Validate complete system, not just task scope"

  forbidden_claims:
    - "Success without running validation commands"
    - "100% pass rate while hiding failures"
    - "Complete work while system degraded"
    - "Sprint closure without evidence verification"
```

#### Four-Eyes Principle Enforcement (Automatic)
```yaml
four_eyes_enforcement:
  complexity_detection:
    - "Tasks affecting >1 file require automatic pairing"
    - "Domain expertise requirements trigger expert consultation"
    - "Quality validation requirements mandate independent review"

  coordination_protocols:
    - "Expert consultation for domain-specific work"
    - "Peer review requirements for all complex changes"
    - "Independent validation of results"
    - "Consensus requirements for complex decisions"
```

### Institutional Learning Integration

#### Learning Outcome Application
```yaml
learning_application:
  behavioral_improvements:
    integration: "Integrate retrospective learning into agent behavioral patterns"
    constraint_updates: "Update behavioral constraints based on learning outcomes"
    prevention_adoption: "Adopt new prevention mechanisms from retrospective analysis"
    institutional_compliance: "Maintain compliance with institutional learning requirements"

  knowledge_contribution:
    pattern_reporting: "Report new failure patterns to institutional memory"
    success_sharing: "Share successful prevention outcomes"
    learning_documentation: "Document learning outcomes for institutional benefit"
    prevention_validation: "Validate prevention mechanism effectiveness"

  continuous_improvement:
    feedback_integration: "Integrate feedback from retrospective sessions"
    process_enhancement: "Apply process improvements from learning outcomes"
    quality_evolution: "Continuously improve quality based on retrospective insights"
    institutional_evolution: "Contribute to institutional learning and improvement"
```

### Retrospective Documentation Standards

When contributing to retrospective sessions, follow these documentation standards:

#### Required Documentation Elements
- **Complete Evidence**: All evidence supporting analysis and conclusions
- **Root Cause Analysis**: Comprehensive 5-Why analysis for any failures
- **Pattern Recognition**: Identification of any failure or success patterns
- **Learning Outcomes**: Specific, actionable learning outcomes
- **Prevention Mechanisms**: Concrete prevention mechanisms developed
- **Implementation Plans**: Clear plans for implementing learning outcomes

#### Memory Storage Requirements
- **Session Documentation**: Complete session analysis stored in institutional memory
- **Pattern Updates**: Failure pattern library updates as needed
- **Learning Integration**: Learning outcomes integrated into agent behavioral patterns
- **Prevention Activation**: Prevention mechanisms made accessible for automatic activation

---

**Remember**: This handbook system enables faster onboarding and consistent behavior across all agents. The retrospective framework ensures continuous learning and crisis prevention. Always start here for project context and retrospective knowledge.
