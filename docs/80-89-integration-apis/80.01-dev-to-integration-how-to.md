# Dev.to Blog Integration Guide

## Overview

JetThoughts maintains a comprehensive blog integration system that synchronizes articles from dev.to to their Hugo-powered website. This system automatically fetches, converts, and manages blog content while maintaining proper canonical URLs and SEO optimization.

## Architecture Components

### 1. Core Integration Files

#### Main Sync Script

- **File**: `bin/sync_with_devto`
- **Purpose**: Entry point for the synchronization process
- **Key Features**:
  - Configurable sources (currently dev.to, with Sanity commented out)
  - Command-line argument support (`-f` for force sync)
  - Extensible architecture for multiple content sources

#### Library Structure (`lib/sync/`)

- **`app.rb`**: Main application controller with configuration management
- **`sync_script.rb`**: Orchestrates the three-phase sync process
- **`sources/dev_to.rb`**: Dev.to-specific data fetching and processing
- **`dev_to_client.rb`**: HTTP client for dev.to API interactions
- **`article_updater.rb`**: Handles article content downloads and processing
- **`article_sync_checker.rb`**: Manages sync status and change detection
- **`post.rb`**: Represents individual blog posts with metadata
- **`images_downloader.rb`**: Downloads and processes article images
- **`sync_status_storage.rb`**: Persistent sync state management

### 2. Data Flow Process

#### Phase 1: Sync Status Update

1. **Article Discovery**: Fetches all articles from dev.to API for user "jetthoughts"
2. **Change Detection**: Compares remote `edited_at` timestamps with local sync status
3. **Slug Generation**: Creates SEO-friendly slugs from article titles and tags
4. **Status Tracking**: Updates sync status YAML file with metadata

#### Phase 2: Content Download

1. **Article Fetching**: Downloads full article content for unsynchronized posts
2. **Metadata Processing**: Extracts and transforms article metadata
3. **Image Processing**: Downloads and localizes all article images
4. **Content Transformation**: Converts dev.to markdown to Hugo-compatible format
5. **File Generation**: Creates Hugo page bundles with `index.md` files

#### Phase 3: Cleanup

1. **Renamed Article Detection**: Identifies articles with changed slugs
2. **Orphaned File Removal**: Cleans up outdated content directories

### 3. URL Mapping System

#### Canonical URL Management

- **File**: `seo/devto_urls_mapping.csv`
- **Format**: `remote_id,slug`
- **Purpose**: Maps dev.to article IDs to local URL slugs
- **SEO Benefits**: Maintains consistent URLs and prevents duplicate content penalties

#### URL Structure

- **Dev.to Format**: `https://dev.to/jetthoughts/article-title-with-random-suffix`
- **Local Format**: `https://jetthoughts.com/blog/clean-slug-with-tags/`
- **Canonical URL**: Always points to the local JetThoughts version

### 4. GitHub Actions Automation

#### Workflow Configuration (`sync-and-publish.yml`)

- **Schedule**: Every 10 minutes during business hours (8 AM - 9 PM UTC)
- **Manual Trigger**: Supports force synchronization via workflow dispatch
- **Ruby Version**: 3.4.2 with bundler cache optimization
- **Environment**: Requires `DEVTO_API_KEY` secret for API access

#### Automated Process

1. **Checkout Code**: Uses `actions/checkout@v4`
2. **Ruby Setup**: Configures Ruby environment with dependencies
3. **Sync Execution**: Runs sync script with optional force flag
4. **Git Operations**: Auto-commits and pushes changes if content updated

## Content Processing Details

### Article Metadata Structure

```yaml
remote_url: https://dev.to/jetthoughts/article-slug
source: dev_to
remote_id: 1234567
dev_to_id: 1234567
dev_to_url: https://dev.to/jetthoughts/article-slug
title: Article Title
description: Article description for SEO
created_at: '2024-01-01T00:00:00Z'
edited_at: '2024-01-01T00:00:00Z'
draft: false
tags: [ruby, rails, tutorial]
canonical_url: https://jetthoughts.com/blog/article-slug/
cover_image: https://raw.githubusercontent.com/.../cover.jpeg
metatags:
  image: cover.jpeg
slug: article-slug-with-tags
```

### Image Processing Pipeline

1. **Cover Image Handling**: Downloads and processes main article images
2. **Inline Image Processing**: Converts external image URLs to local assets
3. **File Naming**: Uses structured naming (`file_0.ext`, `file_1.ext`, etc.)
4. **CDN URL Decoding**: Handles encoded URLs and removes CDN wrappers
5. **Local Storage**: Saves images in article-specific directories

### Content Transformations

- **YouTube Embeds**: Converts dev.to YouTube syntax to Hugo shortcodes
- **Markdown Cleanup**: Ensures Hugo-compatible markdown formatting
- **Asset References**: Updates image paths to reference local files

## Sync Status Management

### Status File Structure (`content/blog/sync_status.yml`)

```yaml
remote_id:
  :edited_at: '2024-01-01T00:00:00Z'
  :slug: article-slug-with-tags
  :synced: true
  :remote_id: 1234567
  :source: dev_to
```

### Change Detection Logic

- **Timestamp Comparison**: Compares remote `edited_at` with local status
- **Force Sync**: Override with `-f` flag to re-sync all articles
- **Incremental Updates**: Only processes changed or new content

## Hugo Integration

### Page Bundle Structure

```
content/blog/article-slug/
├── index.md          # Article content with frontmatter
├── cover.jpeg        # Main article image
├── file_0.png       # Inline images
└── file_1.gif       # Additional assets
```

### SEO Optimization

- **Canonical URLs**: Properly configured to prevent duplicate content
- **Meta Descriptions**: Extracted from dev.to article descriptions
- **Image Optimization**: Local images with proper alt text and metadata
- **Structured Data**: Hugo-compatible frontmatter for rich snippets

## Usage Instructions

### Adding New Blog Posts

1. **Publish on Dev.to**: Create article on dev.to platform
2. **Automatic Sync**: System will detect and sync within 10 minutes
3. **Manual Sync**: Run `bundle exec bin/sync_with_devto` for immediate sync
4. **Force Sync**: Use `-f` flag to re-sync all content

### Manual Operations

#### Force Sync All Articles

```bash
bundle exec bin/sync_with_devto -f
```

#### Dry Run (Test Mode)

```bash
bundle exec bin/sync_with_devto --dry
```

#### Debug Mode

Set log level to debug for verbose output:

```ruby
# In bin/sync_with_devto
App.configure do |config|
  config.logger = Logger.new(STDOUT, level: :debug)
end
```

### Troubleshooting

#### Common Issues

1. **API Rate Limits**: Dev.to API has rate limiting; built-in retry logic handles temporary failures
2. **Image Download Failures**: Network timeouts are retried with exponential backoff
3. **YAML Parsing Errors**: Malformed sync status files are recreated automatically
4. **Missing Canonical URLs**: Articles without proper canonical URLs are updated remotely

#### Error Handling

- **Network Errors**: Automatic retry with configurable delays
- **API Failures**: Graceful degradation with error logging
- **File System Issues**: Directory creation and permission handling
- **Content Validation**: Markdown parsing and structure verification

## Configuration Options

### Environment Variables

- `DEVTO_API_KEY`: Required for updating article metadata on dev.to
- `SYNC_ENV`: Set to 'test' to disable remote updates during development

### Application Settings

- **Working Directory**: Default `content/blog`, configurable via `App.config`
- **Sync Status File**: Default `sync_status.yml`, customizable
- **Concurrent Processing**: Uses tqdm for progress indication
- **Retry Configuration**: Built-in exponential backoff for API calls

## Performance Characteristics

### Optimization Features

- **Incremental Sync**: Only processes changed content
- **Concurrent Image Downloads**: Parallel processing for faster sync
- **Caching**: Avoids unnecessary API calls for unchanged articles
- **Progress Tracking**: Visual progress indicators for long operations

### Scalability Considerations

- **Memory Usage**: Processes articles individually to minimize memory footprint
- **API Efficiency**: Optimized API calls with proper pagination
- **File System Performance**: Efficient directory and file operations
- **GitHub Actions**: Optimized CI/CD pipeline with caching

## Future Enhancements

### Potential Improvements

1. **Multi-Source Support**: Extending beyond dev.to to other platforms
2. **Content Scheduling**: Automated publishing workflows
3. **Analytics Integration**: Track article performance metrics
4. **Content Validation**: Automated quality checks and formatting
5. **Webhook Support**: Real-time sync triggers from dev.to

### Extension Points

- **Custom Sources**: Implement `Sync::Sources::Base` interface
- **Content Processors**: Add custom markdown transformations
- **Metadata Enrichment**: Custom metadata extraction and processing
- **Asset Optimization**: Image compression and format conversion

This integration system provides a robust, automated solution for maintaining synchronized blog content across platforms while optimizing for SEO and user experience.
