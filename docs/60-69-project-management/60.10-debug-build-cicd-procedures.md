---
Global Reference: /knowledge/60.01-global-agent-guidance-reference.md
Authority: Secondary (Extends Global Standards)
Last Synced: 2024-01-19
---

# Debug Build CI/CD Integration Procedures

**COMPREHENSIVE BUILD VALIDATION FOR ZERO-DEFECT DEPLOYMENTS**

## 🚀 **CI/CD Pipeline Integration**

### **Multi-Stage Validation Pipeline**

```yaml
# .github/workflows/comprehensive-validation.yml
name: Comprehensive Validation with Debug Build

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  fast-validation:
    name: "Fast Validation (Regular Build)"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: |
          npm install -g bun
          bun install

      - name: Fast Build Check
        run: bun run build

      - name: Quick Tests
        run: bun run test:links

  comprehensive-validation:
    name: "Comprehensive Validation (Debug Build)"
    runs-on: ubuntu-latest
    needs: fast-validation
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js & Ruby
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
          bundler-cache: true

      - name: Install dependencies
        run: |
          npm install -g bun
          bun install

      - name: Debug Build Validation
        run: |
          echo "🔍 Starting comprehensive debug build validation..."
          bun run test:build 2>&1 | tee hugo-debug.log

      - name: Analyze Debug Output
        run: |
          echo "📊 Analyzing debug output for issues..."

          # Check for critical errors
          if grep -q "ERROR\|FATAL\|template.*failed" hugo-debug.log; then
            echo "❌ CRITICAL: Template or build errors detected"
            grep -E "ERROR|FATAL|template.*failed" hugo-debug.log
            exit 1
          fi

          # Check for missing resources
          if grep -q "not found\|missing.*resource" hugo-debug.log; then
            echo "❌ CRITICAL: Missing resources detected"
            grep -E "not found|missing.*resource" hugo-debug.log
            exit 1
          fi

          # Log performance warnings (non-blocking)
          if grep -q "slow\|warning.*performance" hugo-debug.log; then
            echo "⚠️  Performance warnings detected (non-blocking):"
            grep -E "slow|warning.*performance" hugo-debug.log
          fi

          echo "✅ Debug build analysis complete"

      - name: Full Test Suite
        run: bin/test

      - name: Performance Validation
        run: |
          echo "📈 Running performance validation..."
          bun run analyze

      - name: Upload Debug Logs
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: debug-build-logs
          path: hugo-debug.log
          retention-days: 7

  deployment-readiness:
    name: "Deployment Readiness Check"
    runs-on: ubuntu-latest
    needs: comprehensive-validation
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    steps:
      - uses: actions/checkout@v4

      - name: Final Production Verification
        run: |
          echo "🎯 Final production readiness verification..."
          npm install -g bun
          bun install

          # Final debug build for production deployment
          if bun run test:build; then
            echo "✅ PRODUCTION READY: Debug build passed"
          else
            echo "❌ DEPLOYMENT BLOCKED: Debug build failed"
            exit 1
          fi

          # Ensure no draft content in production
          if grep -r "draft: true" content/ --include="*.md"; then
            echo "❌ DEPLOYMENT BLOCKED: Draft content detected"
            exit 1
          fi

          echo "✅ DEPLOYMENT APPROVED: All validations passed"
```

## 📊 **Build Strategy Decision Matrix**

### **When to Use Each Build Type**

| Development Phase | Regular Build | Debug Build | Command | Purpose |
|-------------------|---------------|-------------|---------|---------|
| **Local Development** | ✅ Primary | ❌ Occasional | `bun run build` | Fast iteration |
| **Content Writing** | ✅ Preview | ❌ Not needed | `bun run build:preview` | Draft preview |
| **Template Development** | ❌ Insufficient | ✅ Required | `bun run test:build` | Template validation |
| **Pre-commit Hook** | ❌ Too basic | ✅ Mandatory | `bin/test` (includes debug) | Comprehensive check |
| **CI Fast Check** | ✅ Speed gate | ❌ Too slow | `bun run build` | Quick validation |
| **CI Full Validation** | ❌ Incomplete | ✅ Complete | `bun run test:build` | Full verification |
| **Production Deploy** | ❌ Risky | ✅ Critical | `bun run test:build` | Final safety check |
| **Performance Audit** | ❌ No metrics | ✅ Essential | `bun run test:build` | Performance analysis |

### **Pre-commit Hook Integration**

```bash
#!/bin/sh
# .git/hooks/pre-commit
# Mandatory debug build validation before commits

echo "🔍 Pre-commit validation with debug build..."

# Stage 1: Quick syntax check
if ! bun run build --quiet; then
    echo "❌ PRE-COMMIT BLOCKED: Basic build failure"
    echo "Fix basic Hugo configuration issues before committing"
    exit 1
fi

# Stage 2: Comprehensive debug validation
echo "📊 Running comprehensive debug build validation..."
if ! bin/test; then
    echo "❌ PRE-COMMIT BLOCKED: Debug build validation failed"
    echo "Run 'bin/test' locally to see detailed error information"
    exit 1
fi

echo "✅ PRE-COMMIT APPROVED: All validations passed"
exit 0
```

## 🎯 **Validation Procedures with Pass/Fail Criteria**

### **Critical Failure Criteria (Build Blocking)**

```bash
# Critical failures that block deployment
check_critical_failures() {
    local debug_log="hugo-debug.log"
    local critical_errors=0

    echo "🚨 Checking for critical failures..."

    # 1. Template Rendering Failures
    if grep -q "template.*error\|failed to render\|template execution failed" "$debug_log"; then
        echo "❌ CRITICAL: Template rendering failures detected"
        ((critical_errors++))
    fi

    # 2. Missing Required Resources
    if grep -q "not found.*required\|missing.*critical" "$debug_log"; then
        echo "❌ CRITICAL: Missing required resources"
        ((critical_errors++))
    fi

    # 3. Configuration Errors
    if grep -q "config.*error\|invalid configuration" "$debug_log"; then
        echo "❌ CRITICAL: Hugo configuration errors"
        ((critical_errors++))
    fi

    # 4. Content Processing Failures
    if grep -q "content.*failed\|markdown.*error" "$debug_log"; then
        echo "❌ CRITICAL: Content processing failures"
        ((critical_errors++))
    fi

    if [[ $critical_errors -eq 0 ]]; then
        echo "✅ CRITICAL CHECK: No blocking issues found"
        return 0
    else
        echo "🚫 DEPLOYMENT BLOCKED: $critical_errors critical error(s)"
        return 1
    fi
}
```

### **Warning Criteria (Non-blocking but Logged)**

```bash
# Warnings that don't block deployment but require attention
check_warnings() {
    local debug_log="hugo-debug.log"
    local warnings=0

    echo "⚠️  Checking for optimization opportunities..."

    # 1. Performance Warnings
    if grep -q "slow template\|template.*ms\|performance warning" "$debug_log"; then
        echo "⚠️  PERFORMANCE: Slow templates detected"
        grep -E "slow template|template.*ms|performance warning" "$debug_log" | head -5
        ((warnings++))
    fi

    # 2. Memory Usage Warnings
    if grep -q "memory usage.*high\|memory warning" "$debug_log"; then
        echo "⚠️  MEMORY: High memory usage detected"
        ((warnings++))
    fi

    # 3. Unused Templates/Resources
    if grep -q "unused template\|unused resource" "$debug_log"; then
        echo "⚠️  CLEANUP: Unused templates/resources found"
        ((warnings++))
    fi

    if [[ $warnings -eq 0 ]]; then
        echo "✅ OPTIMIZATION: No warnings - build is optimized"
    else
        echo "📊 OPTIMIZATION: $warnings warning(s) logged for future optimization"
    fi

    return 0  # Warnings don't block deployment
}
```

### **Success Criteria Checklist**

```bash
# Comprehensive success validation
validate_deployment_readiness() {
    local success_count=0
    local total_checks=7

    echo "🎯 Validating deployment readiness..."

    # 1. Debug build completes successfully
    if bun run test:build > hugo-debug.log 2>&1; then
        echo "✅ Debug build completed successfully"
        ((success_count++))
    else
        echo "❌ Debug build failed"
    fi

    # 2. No critical errors in debug output
    if check_critical_failures; then
        echo "✅ No critical failures detected"
        ((success_count++))
    else
        echo "❌ Critical failures present"
    fi

    # 3. All system tests pass
    if bundle exec rake test > /dev/null 2>&1; then
        echo "✅ All system tests passed"
        ((success_count++))
    else
        echo "❌ System test failures"
    fi

    # 4. Link validation passes
    if bun run test:links > /dev/null 2>&1; then
        echo "✅ All links validated"
        ((success_count++))
    else
        echo "❌ Link validation failures"
    fi

    # 5. No draft content in production
    if ! grep -r "draft: true" content/ --include="*.md" > /dev/null 2>&1; then
        echo "✅ No draft content detected"
        ((success_count++))
    else
        echo "❌ Draft content found in production"
    fi

    # 6. Template metrics within acceptable limits
    if ! grep -q "template.*slow\|template.*error" hugo-debug.log; then
        echo "✅ Template performance acceptable"
        ((success_count++))
    else
        echo "❌ Template performance issues"
    fi

    # 7. Memory usage within limits
    if ! grep -q "memory.*critical\|out of memory" hugo-debug.log; then
        echo "✅ Memory usage within limits"
        ((success_count++))
    else
        echo "❌ Memory usage critical"
    fi

    # Final assessment
    if [[ $success_count -eq $total_checks ]]; then
        echo "🎉 DEPLOYMENT APPROVED: All $total_checks validation checks passed"
        return 0
    else
        echo "🚫 DEPLOYMENT BLOCKED: Only $success_count/$total_checks checks passed"
        return 1
    fi
}
```

## 📈 **Performance Monitoring Integration**

### **Template Performance Tracking**

```bash
# Extract and track template performance metrics
track_template_performance() {
    echo "📊 Extracting template performance metrics..."

    # Parse template metrics from debug output
    if grep -q "templateMetrics" hugo-debug.log; then
        echo "🎯 Template performance analysis:"
        grep -A 20 "templateMetrics" hugo-debug.log | while read -r line; do
            if echo "$line" | grep -q "ms"; then
                template=$(echo "$line" | awk '{print $1}')
                time=$(echo "$line" | grep -o '[0-9]\+ms')

                # Flag slow templates (>50ms)
                if [[ ${time%ms} -gt 50 ]]; then
                    echo "⚠️  SLOW TEMPLATE: $template took $time"
                else
                    echo "✅ $template: $time"
                fi
            fi
        done
    else
        echo "⚠️  No template metrics found - ensure --templateMetrics flag is used"
    fi
}
```

This comprehensive integration ensures that the `test:build` command becomes an essential part of the quality assurance process, catching issues that regular builds miss and providing the detailed validation required for zero-defect deployments.
