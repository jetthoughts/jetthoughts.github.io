# Data Flow Diagrams
**Test Architecture Data Flow and Container Interactions**

## System Overview Diagram

```
                    ┌─────────────────────────────────────────┐
                    │        JetThoughts Hugo Site           │
                    │         Source Repository              │
                    └─────────────┬───────────────────────────┘
                                  │
                                  ▼
                    ┌─────────────────────────────────────────┐
                    │         Docker Compose                 │
                    │      Test Orchestration Layer          │
                    └─────────────┬───────────────────────────┘
                                  │
                    ┌─────────────┴───────────────────────────┐
                    │                                         │
                    ▼                                         ▼
        ┌───────────────────┐                    ┌───────────────────┐
        │  Development      │                    │   Test Execution  │
        │  Environment      │                    │   Environment     │
        └───────────────────┘                    └───────────────────┘
                    │                                         │
                    │                            ┌───────────┴───────────┐
                    │                            │                       │
                    ▼                            ▼                       ▼
        ┌───────────────────┐         ┌─────────────────┐    ┌─────────────────┐
        │   hugo-dev        │         │  Test Tiers     │    │   Monitoring    │
        │ (Port 1313)       │         │   1-4           │    │   & Metrics     │
        └───────────────────┘         └─────────────────┘    └─────────────────┘
```

## Test Tier Data Flow

### Tier 1: Syntax Validation Flow
```
┌──────────────┐    ┌─────────────┐    ┌───────────────┐    ┌─────────────┐
│ Source Files │───▶│ syntax-     │───▶│ Hugo Parser   │───▶│ Validation  │
│ (.md, .html) │    │ checker     │    │ (--dryRun)    │    │ Results     │
└──────────────┘    │ Container   │    └───────────────┘    └─────────────┘
                    │ (64MB)      │
                    └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ No Artifacts│
                    │ Generated   │
                    └─────────────┘

Flow Details:
├── Input: Source files (read-only bind mount)
├── Processing: Hugo template parsing only
├── Memory: <64MB container limit
├── Output: Success/failure status only
└── Duration: <1s target
```

### Tier 2: Memory Rendering Flow
```
┌──────────────┐    ┌─────────────┐    ┌───────────────┐    ┌─────────────┐
│ Source Files │───▶│ memory-     │───▶│ Hugo Build    │───▶│ tmpfs       │
│ + Templates  │    │ renderer    │    │ Engine        │    │ /tmp/hugo-  │
└──────────────┘    │ Container   │    └───────────────┘    │ memory      │
                    │ (256MB)     │            │            └─────────────┘
                    └─────────────┘            │                    │
                           │                   │                    │
                           ▼                   ▼                    ▼
                    ┌─────────────┐    ┌───────────────┐    ┌─────────────┐
                    │ Template    │    │ Content       │    │ Validation  │
                    │ Execution   │    │ Processing    │    │ Results     │
                    └─────────────┘    └───────────────┘    └─────────────┘

Memory Management:
├── Container Limit: 256MB
├── tmpfs Allocation: 128MB
├── Automatic Cleanup: On container termination
└── Zero Disk I/O: All operations in memory
```

### Tier 3: Quick Test Flow
```
┌──────────────┐    ┌─────────────┐    ┌───────────────┐    ┌─────────────┐
│ Git Diff     │───▶│ Changed     │───▶│ quick-tester  │───▶│ Incremental │
│ Detection    │    │ Files List  │    │ Container     │    │ Build       │
└──────────────┘    └─────────────┘    │ (512MB)       │    └─────────────┘
                           │            └───────────────┘            │
                           ▼                    │                    │
                    ┌─────────────┐            │                    │
                    │ Cache Hit   │            │                    │
                    │ Analysis    │            │                    │
                    └─────────────┘            ▼                    ▼
                           │            ┌───────────────┐    ┌─────────────┐
                           │            │ Hugo Build    │    │ Build       │
                           └───────────▶│ (Selective)   │───▶│ Artifacts   │
                                        └───────────────┘    │ public-quick│
                                                             └─────────────┘

Change Detection Pipeline:
├── Git Operations: `git diff --name-only HEAD~1 HEAD`
├── File Filtering: Content, templates, assets, config
├── Cache Strategy: Incremental with change tracking
└── Build Scope: Only affected files and dependencies
```

### Tier 4: Full Validation Flow
```
┌──────────────┐    ┌─────────────┐    ┌───────────────┐    ┌─────────────┐
│ Complete     │───▶│ full-       │───▶│ Production    │───▶│ Complete    │
│ Source Tree  │    │ validator   │    │ Build         │    │ Site        │
└──────────────┘    │ Container   │    │ Pipeline      │    │ public-test │
                    │ (1GB)       │    └───────────────┘    └─────────────┘
                    └─────────────┘            │                    │
                           │                   │                    │
                           ▼                   ▼                    ▼
                    ┌─────────────┐    ┌───────────────┐    ┌─────────────┐
                    │ Persistent  │    │ Asset         │    │ SEO &       │
                    │ Cache       │    │ Processing    │    │ Performance │
                    │ Management  │    │ (Minify, GC)  │    │ Validation  │
                    └─────────────┘    └───────────────┘    └─────────────┘

Production Pipeline:
├── Environment: Production settings
├── Optimizations: Minification, GC, asset bundling
├── Validation: Complete site integrity
└── Output: Deployment-ready artifacts
```

## Container Communication Patterns

### Network Architecture
```
                    ┌─────────────────────────────────────────┐
                    │          Docker Host                    │
                    └─────────────┬───────────────────────────┘
                                  │
                    ┌─────────────┴───────────────────────────┐
                    │                                         │
                    ▼                                         ▼
        ┌───────────────────┐                    ┌───────────────────┐
        │  hugo-network     │                    │  test-network     │
        │  (External)       │                    │  (Internal)       │
        └───────────────────┘                    └───────────────────┘
                    │                                         │
                    │                            ┌───────────┼───────────┐
                    │                            │           │           │
                    ▼                            ▼           ▼           ▼
        ┌───────────────────┐         ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
        │   hugo-dev        │         │ syntax-     │ │ memory-     │ │ quick-      │
        │ localhost:1313    │         │ checker     │ │ renderer    │ │ tester      │
        └───────────────────┘         └─────────────┘ └─────────────┘ └─────────────┘
                                              │           │           │
                                              └───────────┼───────────┘
                                                          │
                                                          ▼
                                              ┌───────────────────┐
                                              │ full-validator    │
                                              └───────────────────┘

Network Isolation Strategy:
├── hugo-network: Development server access (external)
├── test-network: Test execution isolation (internal only)
├── No inter-tier communication: Independent execution
└── Monitoring: Cross-network metrics collection
```

### Volume Mount Strategy
```
Host File System                    Container File Systems
┌─────────────────┐                ┌─────────────────────────────────┐
│ Project Root    │                │         Containers              │
│ /Users/.../     │                └─────────────────────────────────┘
│ jetthoughts.    │                           │
│ github.io       │─────────┐                │
└─────────────────┘         │                │
                            │                │
┌─────────────────┐         │     ┌─────────┴─────────┐
│ Cache Directory │         │     │                   │
│ .hugo-cache/    │────────┐│     │ ┌───────────────┐ │
└─────────────────┘        ││     │ │ syntax-       │ │
                           ││     │ │ checker       │ │
                           ││     │ │ /src (ro)     │ │
                           ││     │ └───────────────┘ │
                           ││     │                   │
                           ││     │ ┌───────────────┐ │
                           ││     │ │ memory-       │ │
                           ││     │ │ renderer      │ │
                           ││     │ │ /src + tmpfs  │ │
                           ││     │ └───────────────┘ │
                           ││     │                   │
                           │└────▶│ ┌───────────────┐ │
                           │      │ │ quick-tester  │ │
                           │      │ │ /src + cache  │ │
                           │      │ └───────────────┘ │
                           │      │                   │
                           └─────▶│ ┌───────────────┐ │
                                  │ │ full-         │ │
                                  │ │ validator     │ │
                                  │ │ /src + cache  │ │
                                  │ └───────────────┘ │
                                  └───────────────────┘

Volume Mapping Strategy:
├── Source Code: Bind mount (read-only for syntax, cached for others)
├── Caches: Named volumes for persistence across runs
├── Build Output: Ephemeral volumes or tmpfs for temporary storage
└── tmpfs: Memory-based storage for ultra-fast I/O
```

## Memory Sharing and Caching Layers

### Cache Hierarchy
```
                    ┌─────────────────────────────────────────┐
                    │           Cache Layers                  │
                    └─────────────────────────────────────────┘
                                      │
                    ┌─────────────────┴─────────────────┐
                    │                                   │
                    ▼                                   ▼
        ┌───────────────────┐                ┌───────────────────┐
        │   L1 Cache        │                │   L2 Cache        │
        │   (Memory)        │                │ (Named Volumes)   │
        └───────────────────┘                └───────────────────┘
                    │                                   │
        ┌───────────┼───────────┐           ┌───────────┼───────────┐
        │           │           │           │           │           │
        ▼           ▼           ▼           ▼           ▼           ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ tmpfs       │ │ Container   │ │ Hugo        │ │ Development │ │ Quick Test  │
│ /tmp/hugo-  │ │ Memory      │ │ Internal    │ │ Cache       │ │ Cache       │
│ memory      │ │ Buffer      │ │ Cache       │ │ Volume      │ │ Volume      │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
    (128MB)        (Variable)     (Disabled)      (Persistent)   (Persistent)

Cache Performance Characteristics:
├── L1 (Memory): 100% hit ratio, zero persistence
├── L2 (Volumes): 80-90% hit ratio, persistent across runs
├── Invalidation: Git-aware change detection
└── Cleanup: Automatic for tmpfs, scheduled for volumes
```

### Memory Optimization Flow
```
Input Data → Memory Allocation → Processing → Cleanup
     │              │                │           │
     │              ▼                │           │
     │    ┌─────────────────┐        │           │
     │    │ Container       │        │           │
     │    │ Memory Limit    │        │           │
     │    │ 64MB - 1GB      │        │           │
     │    └─────────────────┘        │           │
     │              │                │           │
     │              ▼                │           │
     │    ┌─────────────────┐        │           │
     │    │ tmpfs Mount     │        │           │
     │    │ 128MB           │        │           │
     │    │ /tmp/hugo-memory│        │           │
     │    └─────────────────┘        │           │
     │              │                │           │
     └──────────────┼────────────────┘           │
                    │                            │
                    ▼                            │
          ┌─────────────────┐                   │
          │ Hugo Processing │                   │
          │ In-Memory       │                   │
          │ Rendering       │                   │
          └─────────────────┘                   │
                    │                            │
                    ▼                            │
          ┌─────────────────┐                   │
          │ Validation      │                   │
          │ Results         │                   │
          │ (No Artifacts)  │                   │
          └─────────────────┘                   │
                    │                            │
                    └────────────────────────────┘

Memory Management Strategy:
├── Allocation: Progressive limits by tier complexity
├── tmpfs Usage: Zero-copy operations for memory tier
├── Buffer Management: Automatic overflow protection
└── Cleanup: Container termination triggers full cleanup
```

## Test Execution Pipeline

### Sequential vs Parallel Execution
```
Sequential Execution (Current):
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Syntax      │───▶│ Memory      │───▶│ Quick       │───▶│ Full        │
│ <1s         │    │ <3s         │    │ <10s        │    │ <60s        │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
Total Time: ~74s worst case

Parallel Execution (Optimized):
┌─────────────┐    
│ Syntax      │───┐
│ <1s         │   │  ┌─────────────┐    ┌─────────────┐
└─────────────┘   ├─▶│ Memory      │───▶│ Full        │
                  │  │ <3s         │    │ <60s        │
┌─────────────┐   │  └─────────────┘    └─────────────┘
│ Quick       │───┘
│ <10s        │
└─────────────┘
Total Time: ~63s worst case (parallel syntax+quick, then sequential memory→full)

Optimal Parallel Strategy:
├── Syntax + Quick: Parallel execution (independent)
├── Memory: Runs after syntax passes (dependency)
├── Full: Runs after memory passes (dependency)
└── Early Termination: Fail fast on first tier failure
```

### Dependency Management
```
Test Dependencies and Trigger Conditions:

                    ┌─────────────┐
                    │ Source Code │
                    │ Changes     │
                    └─────┬───────┘
                          │
                          ▼
                    ┌─────────────┐
                    │ Git Diff    │
                    │ Analysis    │
                    └─────┬───────┘
                          │
              ┌───────────┼───────────┐
              │           │           │
              ▼           ▼           ▼
      ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
      │ Content     │ │ Templates   │ │ Assets &    │
      │ Changes     │ │ Changes     │ │ Config      │
      └─────────────┘ └─────────────┘ └─────────────┘
              │           │           │
              └───────────┼───────────┘
                          │
                          ▼
                  ┌───────────────┐
                  │ Test Tier     │
                  │ Selection     │
                  └───────┬───────┘
                          │
          ┌───────────────┼───────────────┐
          │               │               │
          ▼               ▼               ▼
  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
  │ Syntax      │ │ Memory      │ │ Quick       │
  │ Always      │ │ Content     │ │ Changed     │
  │             │ │ Changes     │ │ Files       │
  └─────────────┘ └─────────────┘ └─────────────┘
          │               │               │
          └───────────────┼───────────────┘
                          │
                          ▼
                  ┌───────────────┐
                  │ Full          │
                  │ On Main       │
                  │ Branch        │
                  └───────────────┘

Dependency Rules:
├── Syntax: No dependencies, always runs first
├── Memory: Depends on syntax passing
├── Quick: Independent, can run parallel with syntax
└── Full: Depends on memory passing, or runs standalone
```

This comprehensive data flow documentation provides clear visibility into how data moves through the test architecture, how containers communicate, and how the caching and memory optimization strategies work together to achieve optimal performance while maintaining isolation and reproducibility.