# XP Team Deployment for CSS Duplication Elimination

**Date**: 2025-10-12
**Goal Reference**: docs/projects/2509-css-migration/35-39-project-management/35.04-revised-goal-css-duplication-elimination.md
**Strategy Reference**: docs/projects/2509-css-migration/30-39-documentation/30.05-hugo-pipeline-enhancement-strategy.md
**Authority**: /knowledge/20.11-tdd-agent-delegation-how-to.md, /knowledge/42.06-pair-programming-enforcement-how-to.md

---

## ðŸŽ¯ XP Team Structure (Hierarchical Topology)

### Leadership Layer (Coordination)

**XP Coach** (PRIMARY COORDINATOR):
- **Responsibility**: Facilitate pair programming (25min rotation), monitor WIP=1, enforce TDD cycle integrity
- **Reference**: /knowledge/42.06-pair-programming-enforcement-how-to.md
- **Memory Namespace**: `xp/pairs/active/{timestamp}`, `xp/wip/{scope}/{agent_id}`
- **Blocking Authority**: Can STOP work if WIP>1 or pair rotation violated

**TDD Coordinator** (METHODOLOGY ENFORCER):
- **Responsibility**: Orchestrate RED-GREEN-REFACTOR cycle, manage phase transitions
- **Reference**: /knowledge/20.11-tdd-agent-delegation-how-to.md, /knowledge/20.01-tdd-methodology-reference.md
- **Memory Namespace**: `tdd/red-phase/{timestamp}`, `tdd/green-phase/{timestamp}`, `tdd/refactor-phase/{timestamp}`
- **Blocking Authority**: Can STOP work if TDD phase integrity violated

### Expert Layer (Guidance, Not Implementation)

**Test Quality Expert** (BEHAVIORAL TESTING VALIDATOR):
- **Responsibility**: Anti-test-smell detection, behavior-focused testing validation (ZERO tolerance for structural tests)
- **Reference**: /knowledge/25.04-test-smell-prevention-enforcement-protocols.md, docs/60.03-tdd-quality-enforcement.md
- **Memory Namespace**: `tdd/quality-gates/{phase}/{timestamp}`
- **Blocking Authority**: ABSOLUTE - Can reject ANY test that validates implementation details

**CSS Architecture Expert** (DOMAIN KNOWLEDGE):
- **Responsibility**: CSS duplication patterns, FL-Builder foundation knowledge, SCSS best practices, Hugo pipeline integration
- **Reference**: docs/projects/2509-css-migration/30-39-documentation/30.05-hugo-pipeline-enhancement-strategy.md
- **Memory Namespace**: `css-migration/patterns/{pattern_type}`, `css-migration/foundations/{foundation_name}`
- **Blocking Authority**: Can STOP work if CSS consolidation violates FL-Builder compatibility

**Screenshot Guardian** (VISUAL REGRESSION ENFORCER):
- **Responsibility**: ABSOLUTE blocking authority for ANY visual changes during refactoring (tolerance: 0.0)
- **Reference**: /knowledge/25.04-test-smell-prevention-enforcement-protocols.md (Visual Regression Validation Gates)
- **Memory Namespace**: `visual-regression/baseline/{page}`, `visual-regression/validation/{timestamp}`
- **Blocking Authority**: ABSOLUTE - ANY visual change > 0% â†’ IMMEDIATE BLOCK

### Implementation Layer (Paired Agents - MANDATORY PAIRING)

**Test-Writer Pair** (RED Phase):
- **Driver**: Write failing visual regression tests BEFORE CSS changes
- **Navigator**: Validate behavioral focus, ensure no structural/CSS class tests, coordinate test strategy
- **Reference**: /knowledge/20.11-tdd-agent-delegation-how-to.md (RED Phase - Test-First Development)
- **Memory Namespace**: `tdd/red-phase/{work_package_id}`
- **WIP Limit**: 1 task maximum (XP Coach enforces)
- **Rotation**: 25 minutes (Pomodoro technique)

**CSS Extractor Pair** (GREEN Phase - Shameless Green):
- **Driver**: Extract CSS to foundation files using Fake It/Obvious/Triangulation strategies
- **Navigator**: Ensure minimal approach, accept hardcoding, coordinate shameless green implementation
- **Reference**: /knowledge/20.05-shameless-green-flocking-rules-methodology.md
- **Memory Namespace**: `tdd/green-phase/{work_package_id}`, `shameless_green/implementations/{task_id}`
- **WIP Limit**: 1 task maximum
- **Rotation**: 25 minutes

**Refactor Pair** (REFACTOR Phase - Flocking Rules):
- **Driver**: Apply flocking rules systematically: (1) Select things most alike (2) Find smallest difference (3) Make simplest change
- **Navigator**: Ensure tests stay green, validate micro-step approach (â‰¤3 lines per commit)
- **Reference**: /knowledge/20.05-shameless-green-flocking-rules-methodology.md (Flocking Rules Application)
- **Memory Namespace**: `tdd/refactor-phase/{work_package_id}`, `shameless_green/flocking_steps/{refactor_session}`
- **WIP Limit**: 1 task maximum
- **Rotation**: 25 minutes

### Validation Layer (Independent Validators)

**Visual Regression Validator** (CONTINUOUS TESTING):
- **Responsibility**: Run bin/rake test:critical after EACH micro-change, validate tolerance: 0.0 for refactoring
- **Reference**: docs/60.03-tdd-quality-enforcement.md (Test Format Requirements)
- **Memory Namespace**: `test-validation/critical/{timestamp}`
- **Blocking Authority**: Can STOP work on ANY test failure

**Coverage Analyst** (QUALITY METRICS):
- **Responsibility**: Validate >95% test coverage throughout CSS consolidation, track coverage metrics
- **Reference**: /knowledge/20.11-tdd-agent-delegation-how-to.md (Coverage Analysis)
- **Memory Namespace**: `tdd/coverage/{component}/{timestamp}`
- **Blocking Authority**: Can STOP work if coverage drops below 95%

---

## ðŸ“‹ XP Team Execution Protocol

### Pair Programming Enforcement (MANDATORY)

**25-Minute Rotation Cycles** (Pomodoro Technique):
```yaml
rotation_protocol:
  duration: 25 minutes per rotation
  roles:
    - Driver: Writes code, controls keyboard
    - Navigator: Reviews code, strategic thinking, validates approach

  rotation_triggers:
    - Timer expires (25 minutes)
    - Task completion (early rotation allowed)
    - Complexity spike (pair requests expert consultation)

  handoff_protocol:
    - Driver summarizes current state
    - Navigator provides strategic feedback
    - Roles swap (Driver â†’ Navigator, Navigator â†’ Driver)
    - Memory coordination: Store rotation in xp/pairs/rotation/{pair_id}
```

**WIP Limit Enforcement** (XP Coach Responsibility):
```yaml
wip_limit: 1 task per pair MAXIMUM
enforcement:
  - XP Coach monitors active tasks per pair
  - BLOCKING: Cannot start new task while existing task in-progress
  - Coordination: Store WIP state in xp/wip/{scope}/{agent_id}

violation_response:
  - IMMEDIATE HALT if WIP > 1 detected
  - Pair completes current task before starting new work
  - Reflection triggered if repeated WIP violations
```

### TDD Cycle Coordination (TDD Coordinator Responsibility)

**RED Phase Validation**:
```yaml
red_phase_checklist:
  - Test-Writer pair creates failing visual regression test
  - Test Quality Expert validates behavioral focus (NOT structural)
  - Screenshot Guardian captures baseline screenshots (tolerance: 0.0)
  - Test fails with meaningful error message
  - Test validates BEHAVIOR (what users see), NOT implementation (CSS classes)
  - Memory: Store RED phase completion in tdd/red-phase/{work_package_id}
```

**GREEN Phase Validation** (Shameless Green):
```yaml
green_phase_checklist:
  - CSS Extractor pair implements using Fake It/Obvious/Triangulation
  - Accept hardcoding, accept duplication (shameless green methodology)
  - Visual Regression Validator runs bin/rake test:critical
  - ALL tests pass (including new visual regression test)
  - Screenshot Guardian validates ZERO visual changes (tolerance: 0.0)
  - Memory: Store GREEN phase completion in tdd/green-phase/{work_package_id}
```

**REFACTOR Phase Validation** (Flocking Rules):
```yaml
refactor_phase_checklist:
  - Refactor pair applies flocking rules in micro-steps (â‰¤3 lines)
  - Rule 1: Select CSS patterns most alike across files
  - Rule 2: Find smallest differences in selectors/properties
  - Rule 3: Make simplest change to eliminate differences
  - Commit after EACH flocking rule micro-step
  - Visual Regression Validator ensures ALL tests remain GREEN
  - Screenshot Guardian ensures ZERO visual changes throughout
  - Memory: Store REFACTOR completion in tdd/refactor-phase/{work_package_id}
```

---

## ðŸŽ¯ Phase 1 Work Package Assignments

### WP1.1: CSS Variables Foundation (4-6 hours)

**Assigned Pairs**:
- **Test-Writer pair**: Create visual regression tests for CSS variable usage
- **CSS Extractor pair**: Extract system-ui font stack to CSS variables
- **Refactor pair**: Apply flocking rules to consolidate variable references

**Expert Guidance**:
- **CSS Architecture Expert**: Guide SCSS variable structure, Hugo SCSS processor usage
- **Screenshot Guardian**: Validate ZERO visual changes from variable extraction

**Validation**:
- **Visual Regression Validator**: bin/rake test:critical after each file change
- **Coverage Analyst**: Validate >95% coverage for CSS variable usage

**Deliverables**:
- `themes/beaver/assets/css/foundations/_css-variables.scss` (NEW)
- 18 font-family declarations replaced with `var(--font-system-ui)`
- 12 inline critical CSS files updated to reference variables
- 15-20 micro-commits (1 per file + base creation)
- ZERO visual regressions (tolerance: 0.0)

---

### WP1.2: Reset Utilities Extraction (6-8 hours)

**Assigned Pairs**:
- **Test-Writer pair**: Create visual regression tests for reset utility usage
- **CSS Extractor pair**: Extract padding:0 and margin:0 to utility classes
- **Refactor pair**: Apply flocking rules to replace inline declarations

**Expert Guidance**:
- **CSS Architecture Expert**: Guide utility class naming (.u-padding-0, .u-margin-0)
- **Test Quality Expert**: Ensure tests validate BEHAVIOR, not CSS class existence

**Validation**:
- **Visual Regression Validator**: bin/rake test:critical after each change
- **Screenshot Guardian**: ABSOLUTE blocking for ANY visual changes

**Deliverables**:
- `themes/beaver/assets/css/foundations/_reset-utilities.scss` (NEW)
- 59 padding:0 declarations replaced with `.u-padding-0`
- 70 margin:0 declarations replaced with `.u-margin-0`
- 25-30 micro-commits (2-3 per file)
- ZERO visual regressions (tolerance: 0.0)

---

### WP1.3: PowerPack Infobox Pattern (4-6 hours)

**Assigned Pairs**:
- **Test-Writer pair**: Visual regression tests for PowerPack Infobox component
- **CSS Extractor pair**: Extract PowerPack Infobox pattern from services.html
- **Refactor pair**: Consolidate 6 inline duplicates

**Expert Guidance**:
- **CSS Architecture Expert**: PowerPack component patterns, Hugo component CSS
- **Screenshot Guardian**: Services page visual validation (ZERO tolerance)

**Validation**:
- **Visual Regression Validator**: Services page specific tests
- **Coverage Analyst**: PowerPack component coverage validation

**Deliverables**:
- `.c-pp-infobox-standard` utility in component CSS
- 6 inline duplicates replaced with utility reference
- 8-10 micro-commits (1 per duplicate)
- ZERO visual regressions (services.html tolerance: 0.0)

---

### WP1.4: Media Query Consolidation (6-8 hours)

**Assigned Pairs**:
- **Test-Writer pair**: Responsive breakpoint visual regression tests
- **CSS Extractor pair**: Consolidate @media (max-width:860px) repetitions
- **Refactor pair**: Group mobile-specific rules systematically

**Expert Guidance**:
- **CSS Architecture Expert**: Mobile-first responsive patterns, Hugo SCSS breakpoints
- **Screenshot Guardian**: Cross-device visual validation (desktop + mobile)

**Validation**:
- **Visual Regression Validator**: Responsive test suite (multiple viewports)
- **Coverage Analyst**: Breakpoint coverage validation

**Deliverables**:
- `_responsive-utilities.scss` with standard breakpoints
- 168 occurrences consolidated into single @media blocks
- 30-40 micro-commits (2-3 per file)
- ZERO visual regressions across all viewports

---

## ðŸ“Š XP Team Coordination Memory

### Memory Coordination Namespaces

```yaml
xp_coordination:
  pairs:
    active: "xp/pairs/active/{timestamp}"
    rotation: "xp/pairs/rotation/{pair_id}"

  wip:
    monitoring: "xp/wip/{scope}/{agent_id}"

  commits:
    tracking: "xp/commits/{hour_timestamp}"

tdd_coordination:
  phases:
    red: "tdd/red-phase/{work_package_id}"
    green: "tdd/green-phase/{work_package_id}"
    refactor: "tdd/refactor-phase/{work_package_id}"

  quality:
    gates: "tdd/quality-gates/{phase}/{timestamp}"
    coverage: "tdd/coverage/{component}/{timestamp}"

shameless_green:
  implementations: "shameless_green/implementations/{task_id}"
  flocking_steps: "shameless_green/flocking_steps/{refactor_session}"

visual_regression:
  baseline: "visual-regression/baseline/{page}"
  validation: "visual-regression/validation/{timestamp}"
```

---

## âœ… Success Metrics (XP Team Accountability)

### Phase 1 Completion Criteria

**Team Coordination Metrics**:
- Pair rotation compliance: 100% (25min cycles enforced)
- WIP limit violations: 0 (XP Coach enforces WIP=1)
- Micro-commit frequency: 5-20 commits/hour target
- Review gate completion: 100% (Four-Eyes validation)

**TDD Cycle Metrics**:
- RED phase completion: 100% (failing tests created BEFORE code)
- GREEN phase completion: 100% (shameless green implementation passes tests)
- REFACTOR phase completion: 100% (flocking rules applied systematically)
- Test pass rate: 100% (bin/rake test:critical passes throughout)

**Visual Regression Metrics**:
- Build success rate: 100% (Hugo build succeeds throughout)
- Visual test pass rate: 100% (tolerance: 0.0 for refactoring)
- Screenshot Guardian approval: 100% (ZERO visual changes approved)
- Cross-device validation: 100% (desktop + mobile visual consistency)

**Deliverables Metrics**:
- Foundation files created: 4 files (WP1.1-WP1.4)
- Lines eliminated: 300-400 lines (Phase 1 target)
- Micro-commits completed: 78-100 commits
- Zero defects: 100% (no visual regressions, no test failures)

---

## ðŸš€ Next Steps: Initiate Phase 1 Work

**Immediate Actions**:
1. **XP Coach**: Initialize pair programming coordination, establish 25min rotation timers
2. **TDD Coordinator**: Establish RED-GREEN-REFACTOR cycle tracking, validate phase transitions
3. **Test Quality Expert**: Activate behavioral testing validation, zero tolerance test smell detection
4. **Screenshot Guardian**: Capture baseline screenshots for ALL pages (tolerance: 0.0 enforcement)
5. **All Pairs**: Begin WP1.1 (CSS Variables Foundation) with proper TDD cycle

**Memory Coordination Activation**:
```bash
# Initialize XP team memory namespaces
npx claude-flow@alpha hooks pre-task --description "Phase 1 WP1.1: CSS Variables Foundation"

# Activate pair programming tracking
# (XP Coach responsibility)

# Activate TDD phase tracking
# (TDD Coordinator responsibility)

# Activate visual regression baseline
# (Screenshot Guardian responsibility)
```

---

**Document Status**: âœ… XP TEAM DEPLOYED
**Phase**: Phase 1 - Critical CSS Inline Consolidation
**Next Action**: Begin WP1.1 with Test-Writer pair (RED phase)
**Authority**: Official claude-flow TDD methodology + XP practices + Shameless Green methodology
**Last Updated**: 2025-10-12
