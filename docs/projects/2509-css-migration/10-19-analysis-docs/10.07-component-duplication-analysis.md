# Component Duplication Analysis
**Phase 1 Analysis - Component-Level CSS Consolidation Opportunities**
**Generated**: 2025-10-12
**Analysts**: Pattern-Analyst + Code-Searcher pair
**Method**: Component-level grep/serena analysis (NOT property-level)

---

## Executive Summary

**Total Duplication Identified**: 4,271 component duplications across 9 FL layout files
**Largest Opportunities**: .fl-node- page-specific styles (3,926 occurrences), .pp-tabs components (319 occurrences)
**Extraction Priority**: Focus on largest chunk foundations (imports, .fl-node- consolidation, component reuse)

---

## Top 10 Component Duplication Patterns

### 1. FL-Node Page-Specific Styles (HIGHEST PRIORITY)
**Total Occurrences**: 3,926 selector rules across 9 files
**Estimated Lines**: 25,000-35,000 lines (70% of total duplication)
**Pattern**: `.fl-node-{id}` page-specific layout rules

**File Distribution**:
- fl-homepage-layout.css: 1,071 .fl-node- rules
- fl-services-layout.css: 514 .fl-node- rules
- fl-use-cases-layout.css: 513 .fl-node- rules
- fl-clients-layout.css: 442 .fl-node- rules
- fl-service-detail-layout.css: 381 .fl-node- rules
- fl-component-layout.css: 355 .fl-node- rules
- fl-about-layout.css: 338 .fl-node- rules
- fl-careers-layout.css: 175 .fl-node- rules
- fl-contact-layout.css: 137 .fl-node- rules

**Consolidation Strategy**:
- Extract common .fl-node- patterns into foundation files
- Identify reusable layout patterns across node IDs
- Create mixins for frequently repeated node styles
- Maintain page-specific overrides where necessary

---

### 2. PP-Tabs Component System
**Total Occurrences**: 319 component selectors across 3 files
**Estimated Lines**: 800-1,200 lines per file (2,400-3,600 total)
**Pattern**: `.pp-tabs-*` tab component styles

**File Distribution**:
- fl-homepage-layout.css: 157 .pp-tabs selectors
- fl-services-layout.css: 81 .pp-tabs selectors
- fl-use-cases-layout.css: 81 .pp-tabs selectors

**Example Component Block** (from fl-homepage-layout.css):
```css
.pp-tabs-panel-label {
  display: none;
}

.pp-tabs-panel-label span {
  display: table-cell;
  width: 100%;
}

.pp-tabs-panel-label .pp-toggle-icon {
  display: table-cell;
  line-height: inherit;
  opacity: .5;
  filter: alpha(opacity=50);
  padding-left: 15px;
  vertical-align: middle;
  width: auto;
}
```

**Consolidation Strategy**:
- Create `components/_pp-tabs-foundation.scss`
- Extract full component block definitions
- Use @import for foundation, @extend for variants
- Maintain component integrity (no property-level splitting)

---

### 3. FL-Row-Content Layout Foundation
**Total Occurrences**: 26 component selectors across 9 files
**Estimated Lines**: 50-100 lines per file (450-900 total)
**Pattern**: `.fl-row-content` row container styles

**File Distribution**:
- fl-about-layout.css: 3 rules
- fl-careers-layout.css: 3 rules
- fl-clients-layout.css: 3 rules
- fl-component-layout.css: 3 rules
- fl-contact-layout.css: 3 rules
- fl-homepage-layout.css: 2 rules
- fl-service-detail-layout.css: 3 rules
- fl-services-layout.css: 3 rules
- fl-use-cases-layout.css: 3 rules

**Example Component Block** (from fl-builder-grid.css utility):
```css
.fl-row, .fl-row-content {
  margin-left: auto;
  margin-right: auto;
  min-width: 0;
}

.fl-row-content-wrap {
  position: relative;
}
```

**Consolidation Strategy**:
- Already exists in utilities/fl-builder-grid.css
- Validate proper @import usage across all files
- Remove redundant definitions from layout files
- Ensure @import "utilities/fl-builder-grid.css" in all files

---

### 4. FL-Col Grid System
**Total Occurrences**: 13 .fl-col definitions across files
**Estimated Lines**: 600-900 lines (already partially consolidated)
**Pattern**: `.fl-col` grid column base styles

**File Distribution**:
- fl-contact-layout.css: 1 rule
- fl-careers-layout.css: 1 rule
- fl-services-layout.css: 1 rule
- fl-about-layout.css: 1 rule
- fl-clients-layout.css: 1 rule
- fl-clients-alt-bundle.css: 1 rule
- fl-foundation.css: 1 rule (foundation file)
- fl-use-cases-layout.css: 1 rule
- fl-service-detail-layout.css: 1 rule
- fl-component-layout.css: 1 rule
- utilities/fl-builder-basic.css: 1 rule
- utilities/grid/fl-col.css: 1 rule (utility file)
- critical/fl-layout-grid.css: 1 rule

**Example Component Block** (from utilities/grid/fl-col.css):
```css
.fl-col {
  float: left;
  min-height: 1px;
}

.fl-col-content {
  margin: 0;
  padding: 0;
}
```

**Consolidation Strategy**:
- Foundation already exists in utilities/grid/fl-col.css
- Remove redundant .fl-col definitions from layout files
- Ensure single source of truth via @import
- Validate critical path loading (critical/fl-layout-grid.css may need separate handling)

---

### 5. FL-Visible Responsive Display Utilities
**Total Occurrences**: 25 visibility selector groups across 11 files
**Estimated Lines**: 500-800 lines (63 lines * 11 files = ~693 lines)
**Pattern**: `.fl-visible-{desktop|large|medium|mobile}` responsive utilities

**File Distribution**:
- fl-services-layout.css: 2 groups
- fl-contact-layout.css: 2 groups
- fl-about-layout.css: 2 groups
- fl-foundation.css: 4 groups
- fl-component-layout.css: 2 groups
- critical/fl-layout-grid.css: 3 groups
- fl-careers-layout.css: 2 groups
- utilities/fl-builder-visibility.css: 2 groups (foundation file)
- fl-service-detail-layout.css: 2 groups
- fl-use-cases-layout.css: 2 groups
- fl-clients-layout.css: 2 groups

**Example Component Block** (from utilities/fl-builder-visibility.css):
```css
.fl-visible-large, .fl-visible-medium, .fl-visible-mobile,
.fl-col-group-equal-height .fl-col.fl-visible-large,
.fl-col-group-equal-height .fl-col.fl-visible-medium,
.fl-col-group-equal-height .fl-col.fl-visible-mobile {
  display: none;
}

.fl-visible-desktop {
  display: block;
}

.fl-col-group-equal-height .fl-col.fl-visible-desktop {
  display: flex;
}

@media (max-width: 1200px) {
  .fl-visible-desktop, .fl-visible-medium, .fl-visible-mobile,
  .fl-col-group-equal-height .fl-col.fl-visible-desktop,
  .fl-col-group-equal-height .fl-col.fl-visible-medium,
  .fl-col-group-equal-height .fl-col.fl-visible-mobile {
    display: none;
  }
  .fl-visible-large {
    display: block;
  }
  .fl-col-group-equal-height .fl-col.fl-visible-large {
    display: flex;
  }
}
```

**Consolidation Strategy**:
- Foundation already exists in utilities/fl-builder-visibility.css (63 lines)
- Remove ALL redundant visibility definitions from layout files
- Single @import "utilities/fl-builder-visibility.css" source
- Estimated savings: ~630 lines (693 - 63 foundation)

---

### 6. Import Statement Duplication
**Total Occurrences**: 29 @import statements across 7 layout files
**Pattern**: Repeated utility @imports (clearfix, flexbox, display, etc.)

**File Distribution**:
- fl-homepage-layout.css: 12 @imports
- fl-careers-layout.css: 7 @imports
- fl-about-layout.css: 5 @imports
- fl-services-layout.css: 3 @imports
- fl-service-detail-layout.css: 1 @import
- fl-clients-layout.css: 1 @import
- fl-use-cases-layout.css: 0 @imports

**Common Import Patterns**:
```css
/* Repeated in fl-homepage-layout.css (12 imports) */
@import "utilities/clearfix.css";
@import "utilities/flexbox.css";
@import "utilities/display.css";
@import "utilities/typography/text-utilities.css";
@import "utilities/colors/backgrounds.css";
@import "utilities/margins.css";
@import "utilities/padding.css";
@import "utilities/opacity.css";
@import "utilities/fl-builder-visibility.css";
@import "utilities/fl-builder-grid.css";
@import "utilities/fl-builder-basic.css";
@import "utilities/fl-builder-components.css";

/* Repeated in fl-careers-layout.css (7 imports) */
@import "utilities/foundation/reset.css";
@import "utilities/foundation/clearfix.css";
@import "components/c-hero-sections.css";
@import "components/c-infobox.css";
@import "components/c-spacer.css";
@import "components/c-feature-card--row2.css";
@import "components/c-testimonial-section.css";

/* Repeated in fl-about/services-layout.css (3-5 imports) */
@import "utilities/foundation/reset.css";
@import "utilities/foundation/clearfix.css";
@import "utilities/foundation/screen-reader.css";
```

**Consolidation Strategy**:
- Create `foundations/_fl-common-imports.scss` with shared utilities
- Layout files @import foundation file once
- Reduce 29 redundant imports to ~7-10 foundation imports
- Maintain import order for CSS cascade integrity

---

### 7. FL-Col-Group Equal Height Flexbox
**Estimated Occurrences**: ~15-20 component blocks
**Estimated Lines**: 400-600 lines
**Pattern**: `.fl-col-group-equal-height` flex layout system

**Example Component Block** (from fl-builder-grid.css):
```css
.fl-col-group-equal-height {
  display: flex;
  flex-wrap: wrap;
  width: 100%;
}

.fl-col-group-equal-height.fl-col-group-has-child-loading {
  flex-wrap: nowrap;
}

.fl-col-group-equal-height .fl-col, .fl-col-group-equal-height .fl-col-content {
  display: flex;
  flex: 1 1 auto;
}

.fl-col-group-equal-height .fl-col-content {
  flex-direction: column;
  flex-shrink: 1;
  min-width: 1px;
  max-width: 100%;
  width: 100%;
}
```

**Consolidation Strategy**:
- Already exists in utilities/fl-builder-grid.css
- Validate @import across all layout files
- Remove redundant equal-height definitions

---

### 8. FL-Row Background Media
**Estimated Occurrences**: ~10-15 component blocks
**Estimated Lines**: 300-500 lines
**Pattern**: `.fl-row-bg-video`, `.fl-row-bg-photo`, `.fl-row-bg-embed` media background systems

**Example Component Block** (from fl-builder-grid.css):
```css
.fl-row-bg-video, .fl-row-bg-video .fl-row-content, .fl-row-bg-embed, .fl-row-bg-embed .fl-row-content {
  position: relative;
}

.fl-row-bg-video .fl-bg-video, .fl-row-bg-embed .fl-bg-embed-code {
  bottom: 0;
  left: 0;
  overflow: hidden;
  position: absolute;
  right: 0;
  top: 0;
}

.fl-row-bg-video .fl-bg-video video, .fl-row-bg-embed .fl-bg-embed-code video {
  bottom: 0;
  left: 0px;
  max-width: none;
  position: absolute;
  right: 0;
  top: 0px;
}
```

**Consolidation Strategy**:
- Foundation exists in utilities/fl-builder-grid.css
- Ensure proper @import in all layout files using background media

---

### 9. Clearfix System
**Estimated Occurrences**: ~12-15 clearfix blocks
**Estimated Lines**: 200-350 lines
**Pattern**: `.fl-row:before/after`, `.fl-col:before/after` clearfix utilities

**Example Component Block** (from fl-builder-grid.css):
```css
.fl-row:before, .fl-row:after, .fl-row-content:before, .fl-row-content:after, .fl-col-group:before, .fl-col-group:after, .fl-col:before, .fl-col:after, .fl-module:before, .fl-module:after, .fl-module-content:before, .fl-module-content:after {
  display: table;
  content: " ";
}

.fl-row:after, .fl-row-content:after, .fl-col-group:after, .fl-col:after, .fl-module:after, .fl-module-content:after {
  clear: both;
}
```

**Consolidation Strategy**:
- Foundation exists in utilities/fl-builder-grid.css
- Consolidate with clearfix.css utility
- Single @import source

---

### 10. Component-Specific Patterns (c-*, pp-*)
**Estimated Occurrences**: Variable by component
**Estimated Lines**: 1,000-2,000 lines
**Pattern**: Component classes like `.c-hero-sections`, `.c-infobox`, `.c-spacer`, `.c-testimonial-section`

**Import Patterns** (from fl-careers-layout.css):
```css
@import "components/c-hero-sections.css";
@import "components/c-infobox.css";
@import "components/c-spacer.css";
@import "components/c-feature-card--row2.css";
@import "components/c-testimonial-section.css";
```

**Consolidation Strategy**:
- Already organized in components/ directory
- Validate @import usage across layout files
- Ensure single source of truth per component
- No inline component definitions in layout files

---

## File Size Analysis

| File | Lines | Est. Duplication % | Est. Unique Lines | Est. Duplicate Lines |
|------|-------|-------------------|------------------|---------------------|
| fl-homepage-layout.css | 12,324 | 70% | 3,697 | 8,627 |
| fl-services-layout.css | 6,484 | 70% | 1,945 | 4,539 |
| fl-use-cases-layout.css | 6,472 | 70% | 1,942 | 4,530 |
| fl-service-detail-layout.css | 5,470 | 70% | 1,641 | 3,829 |
| fl-clients-layout.css | 5,465 | 70% | 1,640 | 3,825 |
| fl-about-layout.css | 4,463 | 70% | 1,339 | 3,124 |
| fl-careers-layout.css | 3,727 | 70% | 1,118 | 2,609 |
| **TOTAL** | **44,405** | **70%** | **13,322** | **31,083** |

---

## Consolidation Roadmap (Revised Goal Alignment)

### WP2.1: FL-Row Foundation Extraction (800-1,200 lines)
**Target Files**: All 7 layout files
**Components to Extract**:
- .fl-row base styles
- .fl-row-content layout
- .fl-row-content-wrap positioning
- .fl-row background media patterns
- .fl-row clearfix system

**Foundation File**: `foundations/_fl-row-foundation.scss`

---

### WP2.2: FL-Col Grid Foundation Extraction (600-900 lines)
**Target Files**: All 7 layout files
**Components to Extract**:
- .fl-col base grid
- .fl-col-content wrapper
- .fl-col-group patterns
- .fl-col-group-equal-height flexbox
- .fl-col alignment utilities

**Foundation File**: `foundations/_fl-col-foundation.scss`

---

### WP2.3: FL-Responsive Display Foundation Extraction (500-800 lines)
**Target Files**: All 11 files (including utilities and critical)
**Components to Extract**:
- .fl-visible-{desktop|large|medium|mobile}
- Equal-height responsive variants
- Media query breakpoints (1200px, 1115px, 860px)

**Foundation File**: `foundations/_fl-responsive-display.scss`

---

### WP2.4: PP-Tabs Component Consolidation (2,400-3,600 lines)
**Target Files**: fl-homepage-layout.css, fl-services-layout.css, fl-use-cases-layout.css
**Components to Extract**:
- .pp-tabs-panel component system
- .pp-tabs-label variants
- .pp-tabs-horizontal/vertical layouts
- .pp-tabs-style-{1-4} themes

**Foundation File**: `components/_pp-tabs-foundation.scss`

---

### WP2.5: FL-Node Page-Specific Consolidation (25,000-35,000 lines)
**Target Files**: All 9 layout files
**Strategy**:
- Analyze .fl-node- pattern commonalities
- Extract reusable layout patterns
- Create page-specific override files
- Maintain critical path loading integrity

**Foundation Files**:
- `foundations/_fl-node-common-patterns.scss`
- `page-overrides/homepage-nodes.scss`
- `page-overrides/services-nodes.scss`
- etc.

---

## Total Consolidation Impact

**Current Total**: 44,405 lines across 7 files
**Estimated Duplication**: 31,083 lines (70%)
**Post-Consolidation Target**: 13,322 unique lines + 5-7 foundation files (~2,000 lines) = **~15,322 lines**
**Reduction**: **29,083 lines eliminated (65.5% reduction)**

---

## Critical Path CSS Mapping (Next Phase)

**Critical Path Files** (loads FIRST):
- themes/beaver/layouts/partials/header/critical/base-critical.html
- themes/beaver/layouts/partials/header/critical/homepage.html
- themes/beaver/layouts/partials/header/critical/about-us.html
- themes/beaver/layouts/partials/header/critical/careers.html
- themes/beaver/layouts/partials/header/critical/clients.html
- themes/beaver/layouts/partials/header/critical/contact-us.html
- themes/beaver/layouts/partials/header/critical/services.html
- themes/beaver/layouts/partials/header/critical/use-cases.html

**Regular CSS Files** (loads AFTER):
- themes/beaver/assets/css/fl-*.css (all layout files)

**Next Step**: Loading-Priority-Mapper + Critical-Path-Expert pair analysis

---

## Recommendations

1. **Start with Largest Chunks**: WP2.1 (FL-Row), WP2.2 (FL-Col), WP2.3 (FL-Visible) foundations
2. **Validate Loading Priority**: Ensure critical path CSS loads before regular CSS
3. **Component Integrity**: Extract FULL component blocks, NOT individual properties
4. **Test After Each Extraction**: bin/rake test:critical + screenshot comparison (0% tolerance)
5. **Micro-Commit Discipline**: Commit after EACH foundation file creation
6. **Four-Eyes Approval**: Coder → Reviewer → Screenshot Guardian → Tester (ALL required)

---

**Next Phase**: Loading Priority Mapping (10.08-css-loading-priority-map.md)
**Status**: Ready for Phase 2 Foundation Extraction
**XP Coach**: Monitor pair rotations, WIP=1, continuous validation
