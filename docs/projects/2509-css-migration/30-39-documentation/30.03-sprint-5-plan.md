# Sprint 5: Critical CSS Consolidation Phase 1 - Execution Plan

**Sprint Goal**: Consolidate first 7 critical CSS files into base critical.css file (50% of Phase 1 work)
**Duration**: 2-3 days
**Date**: 2025-09-30
**Status**: üìã Ready for Product Owner approval
**Story Points**: 26

---

## üéØ SPRINT GOAL

**Primary Objective**: Eliminate 35-40% CSS duplication by consolidating first 7 critical layout files

**Success Criteria**:
- [ ] 7/14 critical CSS files consolidated into critical.css
- [ ] All tests passing (100% pass rate)
- [ ] Visual regression ‚â§3% tolerance maintained
- [ ] Duplication reduced by 35-40% (measurable via analysis)
- [ ] Micro-commits maintained (‚â§3 lines per change target)

---

## üìã PRODUCT BACKLOG ITEMS (SPRINT 5)

### User Story 1: Developer Maintainability
**As a developer**, I want consolidated CSS files **so that** I can maintain styles efficiently without hunting through 14 separate files.

**Acceptance Criteria**:
- [ ] CSS consolidation reduces file count from 14 ‚Üí 8 (after Sprint 5)
- [ ] No duplicate CSS rules between consolidated files
- [ ] Clear documentation of consolidation strategy
- [ ] All original functionality preserved

**Story Points**: 13 (high complexity)

---

### User Story 2: Visual Consistency
**As a user**, I want consistent visual appearance **so that** the site looks professional and polished across all pages.

**Acceptance Criteria**:
- [ ] Zero visual regressions (screenshot tests ‚â§3% tolerance)
- [ ] Consistent layout behavior across all pages
- [ ] Responsive behavior maintained
- [ ] Cross-browser compatibility verified

**Story Points**: 8 (medium complexity)

---

### User Story 3: Progress Tracking
**As a product owner**, I want measurable duplication reduction **so that** I can track progress toward 100% goal completion.

**Acceptance Criteria**:
- [ ] Duplication analysis report generated before consolidation
- [ ] Duplication analysis report generated after consolidation
- [ ] 35-40% reduction validated via metrics
- [ ] Progress documented in product backlog

**Story Points**: 5 (low complexity)

---

## üêù XP TEAM COMPOSITION

### Specialized Agent Roles

**CSS-Architect (Expert - Guidance Only)**
- **Responsibility**: Architecture decisions, consolidation strategy, duplication analysis
- **Authority**: VETO power over consolidation decisions
- **Reference**: `/knowledge/30.01-agent-coordination-patterns.md`

**CSS-Driver (Implementation Pair 1)**
- **Responsibility**: Write CSS consolidation code, apply flocking rules
- **Rotation**: 25min rotation with CSS-Navigator
- **Reference**: `/knowledge/42.06-pair-programming-enforcement-how-to.md`

**CSS-Navigator (Implementation Pair 2)**
- **Responsibility**: Navigate consolidation strategy, validate behavioral preservation
- **Rotation**: 25min rotation with CSS-Driver
- **Reference**: `/knowledge/42.06-pair-programming-enforcement-how-to.md`

**Visual-Test-Driver (Quality Assurance)**
- **Responsibility**: Execute visual regression tests after EVERY change
- **Testing Protocol**: `bin/rake test:critical` after each micro-commit
- **Reference**: `/projects/jt_site/docs/visual_testing_delegation_workflows.md`

**XP-Coach (Coordination)**
- **Responsibility**: Facilitate pair rotations, monitor WIP=1, TDD cycle integrity
- **Authority**: HALT violations, escalate blockers
- **Reference**: `/knowledge/20.02-four-eyes-principle-global.md`

**TDD-Coordinator (Methodology)**
- **Responsibility**: Orchestrate REFACTOR cycle with flocking rules, manage phase transitions
- **Reference**: `/knowledge/20.11-tdd-agent-delegation-how-to.md`

---

## üóÇÔ∏è FILES TO CONSOLIDATE (SPRINT 5 SCOPE)

### Batch 1: First 7 Critical CSS Files

**Base File (Keep)**:
1. `/Users/pftg/dev/jetthoughts.github.io/themes/beaver/assets/css/critical.css`

**Files to Merge (Priority Order)**:
2. `/Users/pftg/dev/jetthoughts.github.io/themes/beaver/assets/css/base-layout.css`
3. `/Users/pftg/dev/jetthoughts.github.io/themes/beaver/assets/css/homepage-layout.css`
4. `/Users/pftg/dev/jetthoughts.github.io/themes/beaver/assets/css/services-layout.css`
5. `/Users/pftg/dev/jetthoughts.github.io/themes/beaver/assets/css/fl-homepage-layout.css`
6. `/Users/pftg/dev/jetthoughts.github.io/themes/beaver/assets/css/fl-services-layout.css`
7. `/Users/pftg/dev/jetthoughts.github.io/themes/beaver/assets/css/fl-about-layout.css`
8. `/Users/pftg/dev/jetthoughts.github.io/themes/beaver/assets/css/fl-careers-layout.css`

**Remaining for Sprint 6** (7 files):
9. `fl-clients-layout.css`
10. `fl-use-cases-layout.css`
11. `fl-service-detail-layout.css`
12. `fl-contact-layout.css`
13. `fl-component-layout.css`
14. `beaver-grid-layout.css`

---

## üîÑ METHODOLOGY: TDD + FLOCKING RULES

### Phase Execution Strategy

#### Pre-Work: Duplication Analysis (GREEN Phase Preparation)
**Agent**: CSS-Architect
**Duration**: 30 minutes

**Tasks**:
1. Analyze duplication between critical.css and first 7 files
2. Identify duplicate CSS rules
3. Map consolidation strategy
4. Document expected duplication reduction

**Deliverable**: `_runtime/sprint5-duplication-analysis.md`

---

#### Micro-Refactoring Cycle (REFACTOR Phase)

**TDD Phase**: REFACTOR (systematic improvement via flocking rules)
**Reference**: `/knowledge/20.05-shameless-green-flocking-rules-methodology.md`

**Flocking Rules Application**:

**Rule 1: Select things most alike**
- Identify CSS rules with identical selectors across files
- Group rules by component (layout, typography, spacing)

**Rule 2: Find smallest difference**
- Detect minimal differences in property values
- Identify near-duplicate rules with slight variations

**Rule 3: Make simplest change to remove difference**
- Merge identical rules into critical.css
- Apply CSS variables for value differences
- Remove source file after successful merge validation

---

#### Micro-Commit Protocol (MANDATORY)

**For Each File Consolidation**:

1. **Analyze** (CSS-Architect guidance)
   - Review duplication between critical.css and target file
   - Plan consolidation strategy

2. **Merge** (CSS-Driver + CSS-Navigator pair)
   - Copy non-duplicate rules to critical.css
   - Update duplicate rules with CSS variables if needed
   - Maximum ‚â§3 lines changed per micro-commit

3. **Test** (Visual-Test-Driver)
   - Execute `bin/rake test:critical`
   - Validate 100% test pass rate
   - Execute visual regression tests (‚â§3% tolerance)

4. **Commit** (CSS-Driver)
   - Micro-commit with descriptive message
   - Format: "Consolidate [filename] into critical.css (N/7 rules merged)"

5. **Remove** (CSS-Navigator validation)
   - Delete source file ONLY after all tests green
   - Update CSS import references
   - Commit removal separately

6. **Rotate** (XP-Coach facilitation)
   - 25min rotation: CSS-Driver ‚Üî CSS-Navigator
   - Handoff current consolidation context

---

## üìä SUCCESS METRICS

### Duplication Reduction Targets

**Before Sprint 5**:
- 14 critical CSS files
- Estimated 70-80% duplication across files
- Baseline metrics: TBD via analysis

**After Sprint 5 (Target)**:
- 8 critical CSS files (7 consolidated)
- 35-40% duplication eliminated
- Reduction metrics: Documented in sprint retrospective

### Test Quality Targets

**Test Pass Rate**: 100% (zero tolerance for failures)
**Visual Regression Tolerance**: ‚â§3%
**Micro-Commits**: Average ‚â§3 lines per change
**Build Success**: 100% (Hugo build + CSS compilation)

---

## üöß RISK MITIGATION

### Identified Risks

**Risk 1: CSS Specificity Conflicts**
- **Probability**: MEDIUM
- **Impact**: HIGH (visual regressions)
- **Mitigation**: Test after EVERY merge, rollback immediately on conflict
- **Fallback**: Dual-class strategy with temporary namespace

**Risk 2: Build Process Failures**
- **Probability**: LOW
- **Impact**: HIGH (blocks progress)
- **Mitigation**: Validate Hugo build after each file consolidation
- **Fallback**: Rollback to previous working commit

**Risk 3: Visual Regression Failures**
- **Probability**: MEDIUM
- **Impact**: HIGH (user-facing impact)
- **Mitigation**: ‚â§3% tolerance enforcement, screenshot comparison validation
- **Fallback**: Rollback to previous green state

**Risk 4: Duplication Target Not Met**
- **Probability**: LOW
- **Impact**: MEDIUM (sprint goal at risk)
- **Mitigation**: CSS-Architect guidance, thorough duplication analysis
- **Fallback**: Adjust Sprint 6 scope to compensate

---

## üìù SPRINT TASK BREAKDOWN

### Day 1: Files 1-3 (base-layout, homepage-layout, services-layout)

**Morning Session** (4 hours):
- [ ] Pre-work: Duplication analysis (CSS-Architect - 30min)
- [ ] Consolidate base-layout.css ‚Üí critical.css (2 hours)
- [ ] Consolidate homepage-layout.css ‚Üí critical.css (1.5 hours)

**Afternoon Session** (4 hours):
- [ ] Consolidate services-layout.css ‚Üí critical.css (2 hours)
- [ ] Full regression test suite execution (1 hour)
- [ ] Day 1 retrospective and progress report (1 hour)

---

### Day 2: Files 4-6 (fl-homepage, fl-services, fl-about)

**Morning Session** (4 hours):
- [ ] Consolidate fl-homepage-layout.css ‚Üí critical.css (1.5 hours)
- [ ] Consolidate fl-services-layout.css ‚Üí critical.css (1.5 hours)
- [ ] Regression testing (1 hour)

**Afternoon Session** (4 hours):
- [ ] Consolidate fl-about-layout.css ‚Üí critical.css (2 hours)
- [ ] Full regression test suite execution (1 hour)
- [ ] Day 2 retrospective and progress report (1 hour)

---

### Day 3: File 7 + Validation (fl-careers)

**Morning Session** (4 hours):
- [ ] Consolidate fl-careers-layout.css ‚Üí critical.css (2 hours)
- [ ] Full regression test suite execution (1 hour)
- [ ] Duplication analysis post-consolidation (1 hour)

**Afternoon Session** (3 hours):
- [ ] Sprint 5 completion validation (1 hour)
- [ ] Sprint retrospective (1 hour)
- [ ] Sprint 6 planning (1 hour)

---

## üéØ DEFINITION OF DONE (SPRINT 5)

### Sprint Completion Checklist

**Code Quality**:
- [ ] 7/14 critical CSS files consolidated into critical.css
- [ ] Source files removed after successful consolidation
- [ ] No duplicate CSS rules detected
- [ ] Micro-commits maintained (‚â§3 lines per change average)

**Test Quality**:
- [ ] All tests passing (100% pass rate)
- [ ] Visual regression tests passing (‚â§3% tolerance)
- [ ] Hugo build successful
- [ ] CSS compilation successful

**Documentation Quality**:
- [ ] Duplication analysis documented (before/after)
- [ ] Consolidation strategy documented
- [ ] Sprint retrospective completed
- [ ] Progress reported to Product Owner

**Product Owner Acceptance**:
- [ ] 35-40% duplication reduction validated
- [ ] Sprint goal achieved
- [ ] User stories accepted
- [ ] Sprint 6 planning approved

---

## üîÑ COORDINATION PATTERNS

### Memory Coordination (Official Claude-Flow)

```yaml
sprint5_memory_namespaces:
  consolidation_tracking: "sprint5/consolidation/{file_number}/{timestamp}"
  duplication_analysis: "sprint5/duplication/{phase}/{timestamp}"
  test_results: "sprint5/test-results/{micro-commit}/{timestamp}"
  pair_rotation: "sprint5/pair-rotation/{rotation_number}/{timestamp}"
  sprint_progress: "sprint5/progress/{day}/{timestamp}"
```

### Agent Communication Protocol

**Pre-Task Coordination**:
```bash
echo "üîç Pre-Sprint 5 validation: CSS consolidation Phase 1"
npx claude-flow@alpha hooks pre-task --description "Sprint 5: Consolidate first 7 critical CSS files"
```

**Post-Task Coordination**:
```bash
echo "‚úÖ Post-Sprint 5 validation: Phase 1 complete"
npx claude-flow@alpha hooks post-task --task-id "sprint5-critical-css-phase1"
```

---

## üéâ SPRINT 5 SUCCESS CRITERIA

| Criterion | Target | Validation Method | Status |
|-----------|--------|-------------------|--------|
| **Files consolidated** | 7/14 | File count verification | Pending |
| **Duplication reduced** | 35-40% | Analysis report comparison | Pending |
| **Test pass rate** | 100% | `bin/rake test:critical` | Pending |
| **Visual regressions** | 0 (‚â§3%) | Screenshot comparison | Pending |
| **Micro-commits** | ‚â§3 lines avg | Git log analysis | Pending |
| **Build success** | 100% | Hugo build validation | Pending |
| **User story acceptance** | 3/3 | Product Owner approval | Pending |

---

## üöÄ NEXT STEPS (POST-SPRINT 5)

**Immediate**:
- [ ] Sprint 5 retrospective with full XP team
- [ ] Duplication analysis report comparison
- [ ] Sprint 6 planning (remaining 7 files)
- [ ] Product Owner acceptance validation

**Sprint 6 Preparation**:
- [ ] Review Sprint 5 lessons learned
- [ ] Adjust consolidation strategy if needed
- [ ] Plan remaining 7 file consolidations
- [ ] Coordinate with Phase 2 planning (HTML migration)

---

**Sprint Owner**: Product Owner (CSS Migration Goal Guardian)
**Scrum Master**: XP-Coach Agent
**Development Team**: CSS-Architect, CSS-Driver, CSS-Navigator, Visual-Test-Driver, TDD-Coordinator
**Methodology**: Official Claude-Flow TDD + XP Pair Programming + Flocking Rules
**Reference**: `/knowledge/20.11-tdd-agent-delegation-how-to.md`, `/knowledge/42.06-pair-programming-enforcement-how-to.md`, `/knowledge/20.05-shameless-green-flocking-rules-methodology.md`

---

**Last Updated**: 2025-09-30
**Status**: Ready for Product Owner approval
**Branch**: TBD (create sprint5-critical-css-consolidation branch upon approval)