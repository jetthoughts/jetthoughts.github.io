# TOP-DOWN CSS Consolidation Strategy
**Project**: jt_site CSS Architecture Migration
**Analysis Date**: 2025-10-14
**Total Files**: 149 CSS files
**Current Status**: Bottom-up approach caused cascade dependency issues
**New Approach**: TOP-DOWN layer-by-layer consolidation

---

## üéØ STRATEGIC INSIGHT: Why TOP-DOWN?

### ‚ùå Previous Bottom-Up Failures
- Consolidated page-specific files (404.css, 3114-layout.css) **FIRST**
- Removed "duplicate" FL-Builder CSS from numbered layouts
- **Result**: 9.5% desktop / 15.4% mobile visual regressions
- **Root Cause**: Page-specific files depend on foundation/utility layers that weren't loaded

### ‚úÖ TOP-DOWN Solution
- Consolidate foundation layers **FIRST** (CSS variables, resets, base utilities)
- Establish shared infrastructure that ALL pages can reference
- Consolidate page-specific files **LAST** when dependencies clear
- **Principle**: Build the foundation before removing scaffolding

---

## üìä ARCHITECTURAL LAYER ANALYSIS (149 Files Categorized)

### **LAYER 0: CSS FOUNDATIONS** (3 files) - **FIRST PRIORITY**
**Purpose**: CSS custom properties, design tokens, global variables
**Cascade Position**: Must load BEFORE all other CSS (highest precedence)

```yaml
layer_0_foundations:
  existing_files:
    - foundations/css-variables.css          # 9 lines - :root { --font-system-ui }
    - variables/colors.css                   # Color tokens (if exists)
    - critical/base-reset.css                # 9 lines - margin reset for .fl-row-content-wrap

  consolidation_candidates:
    # Already well-organized - VALIDATE NO DUPLICATES
    - Audit: Check if color tokens exist in multiple files
    - Audit: Verify css-variables.css loaded FIRST in critical CSS
    - Audit: Identify any inline :root {} blocks in other files

  consolidation_strategy:
    priority: "IMMEDIATE - Week 1"
    approach: "Audit and validate - create single source of truth for :root variables"
    target_file: "foundations/css-variables.css (expand if needed)"
    validation: "Zero visual changes - variables only affect computed values"
    risk_level: "LOW - variables have no visual impact if unchanged"
```

---

### **LAYER 1: BASE/FOUNDATION PATTERNS** (8 files) - **SECOND PRIORITY**
**Purpose**: CSS resets, box-sizing, clearfix, screen-reader utilities
**Cascade Position**: Load AFTER Layer 0, BEFORE utilities/components

```yaml
layer_1_base_patterns:
  existing_files:
    - utilities/foundation/reset.css         # 12 lines - box-sizing for .fl-builder-content
    - utilities/foundation/screen-reader.css # Screen reader utility classes
    - utilities/clearfix.css                 # 9 lines - .pp-clearfix pattern
    - utilities/fl-builder-basic.css         # FL-Builder base patterns
    - critical/base.css                      # Critical base styles
    - fl-foundation.css                      # FL-Builder foundation (5.9KB)
    - components/foundation.css              # Component foundations
    - components/layout-foundation.css       # Layout base patterns

  consolidation_candidates:
    # HIGH DUPLICATION DETECTED:
    box_sizing_reset:
      - utilities/foundation/reset.css (lines 6-11)
      - 2949-layout.css (lines 3-7)          # DUPLICATE
      - 3021-layout.css (lines 3-7)          # DUPLICATE
      - [ALL numbered layouts have this]     # ESTIMATED 20+ duplicates

    clearfix_pattern:
      - utilities/clearfix.css (.pp-clearfix)
      - utilities/fl-builder-grid.css (.fl-row:after, .fl-col:after, etc.)
      - 2949-layout.css (lines 9-29)         # DUPLICATE FL-Builder clearfix
      - [ALL numbered layouts have this]     # ESTIMATED 20+ duplicates

    sr_only_utility:
      - utilities/foundation/screen-reader.css
      - 2949-layout.css (lines 31-40)        # DUPLICATE .sr-only
      - [Multiple page files have this]      # ESTIMATED 10+ duplicates

  consolidation_strategy:
    priority: "IMMEDIATE - Week 1-2"
    approach: "Create SINGLE authoritative base-foundation.css loaded in ALL critical CSS"
    target_file: "critical/base-foundation.css (new unified file)"
    consolidation_plan:
      step_1: "Merge utilities/foundation/* into single file"
      step_2: "Add FL-Builder clearfix from utilities/fl-builder-grid.css"
      step_3: "Remove ALL duplicates from numbered layouts (2949, 3021, etc.)"
      step_4: "Update critical CSS partials to @import base-foundation.css"

    expected_impact:
      duplicates_eliminated: "60+ duplicate rule sets (box-sizing, clearfix, sr-only)"
      file_size_reduction: "~3KB per page-specific file √ó 20 files = 60KB total"
      visual_risk: "ZERO - foundation patterns have no visual dependencies"

    validation_protocol:
      pre_consolidation:
        - "Capture baseline screenshots for ALL pages"
        - "Document which pages load which foundation files"
      post_consolidation:
        - "Compare screenshots with tolerance: 0.0"
        - "Verify box-sizing applies correctly across all pages"
        - "Test clearfix functionality on grid layouts"

  critical_insight:
    "üö® BLOCKER RESOLUTION: 404.css and 3114-layout.css currently DON'T load base-foundation.
    They need box-sizing and clearfix but load them inline.
    Solution: Ensure base-foundation.css loaded in ALL critical CSS partials including 404-critical.html"
```

---

### **LAYER 2: UTILITY CLASSES** (25 files) - **THIRD PRIORITY**
**Purpose**: Atomic utility classes (margins, padding, display, flexbox, colors)
**Cascade Position**: Load AFTER base patterns, BEFORE components

```yaml
layer_2_utility_classes:
  existing_files:
    # Already well-organized in utilities/ directory
    - utilities/margins.css                  # 8 lines - .m-auto, .m-0, .m-t-10, etc.
    - utilities/padding.css                  # Padding utilities
    - utilities/display.css                  # 10 lines - .d-none, .d-block, etc.
    - utilities/flexbox.css                  # Flexbox utilities
    - utilities/position.css                 # Position utilities
    - utilities/opacity.css                  # Opacity utilities
    - utilities/colors.css                   # Color utilities
    - utilities/colors/backgrounds.css       # Background color utilities
    - utilities/typography/text-utilities.css # Text utilities
    - utilities/color-accessibility.css      # Accessibility color utilities
    - utilities/c-spacing.css                # Spacing utilities
    - utilities/responsive/visibility.css    # Responsive visibility
    - utilities/responsive/breakpoints.css   # Breakpoint utilities
    - utilities/fl-builder-visibility.css    # FL-Builder visibility rules
    - utilities/fl-builder-components.css    # FL-Builder component utilities
    - utilities/grid/fl-col.css              # Grid column utilities
    - utilities/positioning/center-absolute.css # Absolute centering
    - utilities/components/powerpack/content-grid.css
    - utilities/components/powerpack/infobox.css
    - utilities/components/powerpack/pp-icon.css
    - utilities/components/powerpack/pp-list.css
    - components/css-utilities.css           # Mixed utilities
    - _consolidated-utilities.css            # Master import file

  consolidation_candidates:
    # MODERATE DUPLICATION DETECTED:
    margin_padding_utilities:
      - utilities/margins.css (8 lines)
      - utilities/padding.css
      - Inline utilities in numbered layouts   # ESTIMATED 15+ files with duplicates

    display_utilities:
      - utilities/display.css (10 lines)
      - Inline .d-none, .d-block in layouts    # ESTIMATED 10+ duplicates

    visibility_utilities:
      - utilities/fl-builder-visibility.css    # Authoritative source
      - utilities/responsive/visibility.css    # May overlap
      - Duplicate .fl-visible-* rules removed from numbered layouts (already done)

  consolidation_strategy:
    priority: "MODERATE - Week 2-3"
    approach: "Validate existing utilities/ organization, eliminate inline duplicates"
    target_state: "ALL utilities loaded via _consolidated-utilities.css @import structure"

    consolidation_plan:
      step_1: "Audit utilities/ directory - ensure NO overlaps between files"
      step_2: "Search numbered layouts for inline utility class definitions"
      step_3: "Remove inline utilities, verify pages load _consolidated-utilities.css"
      step_4: "Create utility documentation mapping (which file contains which utilities)"

    expected_impact:
      duplicates_eliminated: "30+ duplicate utility definitions"
      file_size_reduction: "~1KB per page √ó 15 files = 15KB total"
      visual_risk: "LOW - utilities are atomic, well-tested patterns"

    validation_protocol:
      pre_consolidation:
        - "Identify which pages DON'T load _consolidated-utilities.css"
        - "Document inline utility usage in numbered layouts"
      post_consolidation:
        - "Screenshot comparison tolerance: 0.0"
        - "Verify utility classes apply consistently across pages"

  critical_insight:
    "‚úÖ STRENGTH: utilities/ directory already well-organized with _consolidated-utilities.css master.
    Focus: Ensure ALL pages load this master file, eliminate inline duplicates."
```

---

### **LAYER 3: COMPONENT STYLES** (30 files) - **FOURTH PRIORITY**
**Purpose**: Reusable component patterns (buttons, cards, navigation, forms)
**Cascade Position**: Load AFTER utilities, BEFORE layout patterns

```yaml
layer_3_component_styles:
  existing_files:
    # Well-organized in components/ directory
    - components/buttons.css                 # 22 lines - .fl-button base styles
    - components/buttons-migration.css       # Button migration patterns
    - components/c-button.css                # BEM button component
    - components/cards-migration.css         # Card migration patterns
    - components/blocks/c-card.css           # BEM card component
    - components/blocks/c-content.css        # Content blocks
    - components/blocks/c-hero.css           # Hero blocks
    - components/blocks/c-nav.css            # Navigation blocks
    - components/navigation.css              # Navigation base
    - components/navigation-migration.css    # Nav migration
    - components/c-navigation.css            # BEM navigation
    - components/c-pp-advanced-menu.css      # PowerPack menu
    - components/forms.css                   # Form base styles
    - components/forms-migration.css         # Form migration
    - components/c-gravity-forms.css         # Gravity Forms component
    - components/typography.css              # Typography component
    - components/content-block.css           # Content block component
    - components/c-cta-blocks.css            # CTA block component
    - components/c-feature-card--row2.css    # Feature card variant
    - components/c-hero-sections.css         # Hero section component
    - components/c-infobox.css               # Infobox component
    - components/c-modal.css                 # Modal component
    - components/c-pagination.css            # Pagination component
    - components/c-pp-buttons.css            # PowerPack buttons
    - components/c-pp-content-grid.css       # PowerPack content grid
    - components/c-pp-infobox.css            # PowerPack infobox
    - components/c-pp-widgets.css            # PowerPack widgets
    - components/c-social-share.css          # Social share component
    - components/c-spacer.css                # Spacer component
    - components/c-testimonial-section.css   # Testimonial section
    - components/c-testimonial-slider.css    # Testimonial slider
    - components/c-testimonials.css          # Testimonials component
    - components/pp-content-grid.css         # PowerPack grid
    - components/pp-list.css                 # PowerPack list
    - components/pp-tabs.css                 # PowerPack tabs
    - components/layout-columns.css          # Column layout component
    - components/layout-rows.css             # Row layout component
    - components/alerts.css                  # Alert component
    - _consolidated-components.css           # Master import file

  consolidation_candidates:
    # LOW-MODERATE DUPLICATION:
    button_styles:
      - components/buttons.css (base)
      - components/c-button.css (BEM)
      - components/buttons-migration.css (migration)
      - components/c-pp-buttons.css (PowerPack)
      - Inline button overrides in numbered layouts  # ESTIMATED 10+ files

    navigation_styles:
      - components/navigation.css (base)
      - components/c-navigation.css (BEM)
      - components/navigation-migration.css (migration)
      - components/c-pp-advanced-menu.css (PowerPack)

    form_styles:
      - components/forms.css (base)
      - components/c-gravity-forms.css (Gravity Forms)
      - components/forms-migration.css (migration)

  consolidation_strategy:
    priority: "MODERATE - Week 3-4"
    approach: "Maintain component modularity, eliminate cross-component duplicates"
    target_state: "Each component has SINGLE authoritative file, no inline overrides"

    consolidation_plan:
      step_1: "Audit component pairs (base vs BEM vs migration)"
      step_2: "Merge migration CSS into base component files"
      step_3: "Document component API (which classes each file provides)"
      step_4: "Remove inline component overrides from numbered layouts"
      step_5: "Ensure ALL pages load component-bundle.css or _consolidated-components.css"

    expected_impact:
      duplicates_eliminated: "20+ duplicate component definitions"
      file_size_reduction: "~2KB per page √ó 10 files = 20KB total"
      visual_risk: "MODERATE - component changes can affect multiple pages"

    validation_protocol:
      pre_consolidation:
        - "Screenshot ALL pages with component usage"
        - "Document which numbered layouts have inline component CSS"
      post_consolidation:
        - "Screenshot comparison tolerance: 0.01 (allow minor rendering differences)"
        - "Test component interactivity (buttons, forms, modals)"
        - "Verify responsive behavior at all breakpoints"

  critical_insight:
    "‚ö†Ô∏è RISK AREA: Component CSS has visual impact. Requires careful testing.
    Strategy: Consolidate conservatively, test each component type separately."
```

---

### **LAYER 4: LAYOUT PATTERNS** (15 files) - **FIFTH PRIORITY**
**Purpose**: Grid systems, FL-Builder layouts, page structure patterns
**Cascade Position**: Load AFTER components, BEFORE page-specific CSS

```yaml
layer_4_layout_patterns:
  existing_files:
    - utilities/fl-builder-grid.css          # 50+ lines - FL-Builder grid system
    - critical/fl-layout-grid.css            # Critical grid patterns
    - critical/fl-common-modules.css         # Common FL-Builder modules
    - critical/fl-shape-dividers.css         # Shape divider patterns
    - beaver-grid-layout.css                 # Beaver theme grid (5.9KB)
    - components/layout-foundation.css       # Layout base
    - components/layout-columns.css          # Column layouts
    - components/layout-rows.css             # Row layouts
    - fl-foundation.css                      # FL-Builder foundation (5.9KB)
    - fl-component-layout.css                # Component layouts (5KB)
    - _consolidated-layouts.css              # Master layout import

  consolidation_candidates:
    # HIGH DUPLICATION DETECTED:
    fl_builder_grid:
      - utilities/fl-builder-grid.css (authoritative)
      - Duplicate FL-Builder grid in 2949-layout.css (lines 9-100+)
      - Duplicate FL-Builder grid in 3021-layout.css
      - Duplicate FL-Builder grid in 3027-layout.css
      - [ALL numbered layouts have this]     # ESTIMATED 20+ duplicates

    fl_col_group:
      - utilities/fl-builder-grid.css (.fl-col-group patterns)
      - Duplicated in numbered layouts       # ESTIMATED 20+ files

    fl_row_patterns:
      - critical/fl-layout-grid.css (.fl-row patterns)
      - Duplicated in numbered layouts       # ESTIMATED 20+ files

  consolidation_strategy:
    priority: "HIGH - Week 2-3"
    approach: "Establish SINGLE FL-Builder grid system, remove ALL page-specific duplicates"
    target_state: "utilities/fl-builder-grid.css as authoritative source, loaded globally"

    consolidation_plan:
      step_1: "Validate utilities/fl-builder-grid.css completeness"
      step_2: "Ensure ALL critical CSS partials @import fl-builder-grid.css"
      step_3: "Remove FL-Builder grid duplicates from numbered layouts (2949, 3021, etc.)"
      step_4: "Verify 404.css and 3114-layout.css load fl-builder-grid.css"

    expected_impact:
      duplicates_eliminated: "60+ duplicate FL-Builder grid rule sets"
      file_size_reduction: "~4KB per page √ó 20 files = 80KB total"
      visual_risk: "HIGH - grid changes affect layout structure"

    validation_protocol:
      pre_consolidation:
        - "MANDATORY: Capture baseline screenshots for ALL pages"
        - "Document grid usage patterns per page"
      post_consolidation:
        - "Screenshot comparison tolerance: 0.0 (ZERO tolerance for layout changes)"
        - "Test grid responsiveness at all breakpoints (mobile, tablet, desktop)"
        - "Verify equal-height columns, flex layouts, grid alignment"

  critical_insight:
    "üö® CRITICAL: This is where 404.css and 3114-layout.css consolidation FAILED.
    Root cause: Pages didn't load fl-builder-grid.css infrastructure.
    Solution: Create 404-critical.html and blog-critical.html that @import base infrastructure."

  blocklist:
    # DO NOT consolidate these files until critical CSS infrastructure created
    - 404.css                                # No 404-critical.html infrastructure
    - 3114-layout.css                        # No blog-critical.html infrastructure
```

---

### **LAYER 5: PAGE-SPECIFIC STYLES** (50+ files) - **LAST PRIORITY**
**Purpose**: Page-unique CSS with .fl-node-* selectors and layout-specific overrides
**Cascade Position**: Load LAST (lowest cascade priority, highest specificity)

```yaml
layer_5_page_specific:
  existing_files:
    # Numbered page layouts (FL-Builder generated)
    numbered_layouts:
      - 2949-layout.css                      # 5.4KB - Page ID 2949
      - 3021-layout.css                      # 6.4KB - Page ID 3021
      - 3027-layout.css                      # 5.1KB - Page ID 3027
      - 3059-layout.css                      # Size unknown
      - 3082-layout.css                      # 5.4KB - Page ID 3082
      - 3086-layout2.css                     # 5.2KB - Page ID 3086
      - 3114-layout.css                      # 2.3KB - Blog page (BLOCKLISTED)
      - 404.css                              # 4.8KB - 404 page (BLOCKLISTED)
      - 586.css                              # Size unknown
      - 590-layout.css                       # 13.1KB - Largest page-specific file
      - 701-layout.css                       # 4.5KB
      - 706-layout.css                       # 2.2KB
      - 737-layout.css                       # 6.5KB

    # Semantic page layouts (Hugo templates)
    semantic_layouts:
      - homepage-layout.css                  # 2.7KB - Homepage overrides
      - homepage.css                         # Homepage styles
      - services-layout.css                  # Services page
      - careers.css                          # Careers page
      - companies.css                        # Companies/clients page
      - technologies.css                     # Technologies page
      - single-post.css                      # Blog single post
      - footer.css                           # Footer overrides
      - navigation.css                       # Navigation overrides
      - pagination.css                       # Pagination overrides

    # FL-Builder semantic layouts
    fl_layouts:
      - fl-homepage-layout.css               # 12.3KB - Largest FL layout
      - fl-about-layout.css                  # 4.4KB
      - fl-careers-layout.css                # 3.7KB
      - fl-clients-layout.css                # 5.4KB
      - fl-clients-alt-bundle.css            # 6.5KB
      - fl-clients-bundle.css                # Size unknown
      - fl-component-layout.css              # 5KB
      - fl-contact-layout.css                # 2.2KB
      - fl-service-detail-layout.css         # 6.3KB
      - fl-services-layout.css               # 6.5KB
      - fl-use-cases-layout.css              # 6.3KB

    # Bundle files (hashed FL-Builder exports)
    bundle_files:
      - bf72bba397177a0376baed325bffdc75-layout-bundle.css  # 2KB
      - e93d9b85e7803f50c80b8a698f8d12f9-layout-bundle.css  # Size unknown
      - e966db44b09892b8d7d492247c67e86c-layout-bundle.css  # 4.4KB
      - fb2624e43f3c4277448abe268cde571e-layout-bundle.css  # 6.5KB

    # Specialized page CSS
    specialized_layouts:
      - bem-404-conversion.css               # 404 BEM conversion
      - bem-home-page-minimal.css            # Homepage BEM conversion
      - dynamic-404-590.css                  # Dynamic 404/590 styles
      - dynamic-icons.css                    # Dynamic icon styles
      - use-cases-dynamic.css                # Dynamic use-cases styles
      - cta-backgrounds.css                  # CTA background patterns
      - mobile-fixes.css                     # Mobile-specific fixes
      - skin-65eda28877e04.css               # FL-Builder skin (2.7KB)

  consolidation_candidates:
    # CRITICAL: These files contain BOTH duplicates AND page-specific CSS
    mixed_content_pattern:
      characteristics:
        - "Lines 1-100: Foundation patterns (box-sizing, clearfix, FL-Builder grid)"
        - "Lines 100-300: Utility classes (margins, display, visibility)"
        - "Lines 300-500: Component overrides (buttons, cards, navigation)"
        - "Lines 500+: Page-specific .fl-node-* selectors (MUST PRESERVE)"

      example_2949_layout_css:
        - "Lines 1-40: Foundation duplicates (remove ‚Üí use base-foundation.css)"
        - "Lines 41-100: FL-Builder grid duplicates (remove ‚Üí use fl-builder-grid.css)"
        - "Lines 101-200: Utility duplicates (remove ‚Üí use _consolidated-utilities.css)"
        - "Lines 201-500: Component overrides (evaluate case-by-case)"
        - "Lines 501+: .fl-node-5a1b2c3d selectors (PRESERVE - page-specific)"

    duplication_analysis:
      foundation_layer:
        pattern: "box-sizing, clearfix, sr-only"
        files_affected: "ALL numbered layouts (20+ files)"
        consolidation: "Remove ‚Üí load base-foundation.css"

      grid_layer:
        pattern: "FL-Builder grid (.fl-row, .fl-col, .fl-col-group)"
        files_affected: "ALL numbered layouts (20+ files)"
        consolidation: "Remove ‚Üí load fl-builder-grid.css"

      utility_layer:
        pattern: "Margin/padding/display utilities"
        files_affected: "15+ numbered layouts"
        consolidation: "Remove ‚Üí load _consolidated-utilities.css"

      component_layer:
        pattern: "Button/card/navigation overrides"
        files_affected: "10+ numbered layouts"
        consolidation: "EVALUATE - may be page-specific customizations"

      page_specific_layer:
        pattern: ".fl-node-*, .fl-module-*, layout-critical CSS"
        files_affected: "ALL page-specific files"
        consolidation: "PRESERVE - this is the PURPOSE of these files"

  consolidation_strategy:
    priority: "LOW - Week 4-6 (AFTER Layers 0-4 complete)"
    approach: "Systematic layer-by-layer stripping of duplicates, preserve page-specific CSS"
    target_state: "Page files contain ONLY .fl-node-* selectors and layout-critical overrides"

    consolidation_plan:
      phase_1_foundation_removal:
        step_1: "For EACH numbered layout (2949, 3021, etc.)"
        step_2: "Remove lines 1-40 (foundation duplicates)"
        step_3: "Verify page loads base-foundation.css via critical CSS"
        step_4: "Test with tolerance: 0.0, rollback if visual changes"

      phase_2_grid_removal:
        step_1: "Remove FL-Builder grid duplicates (lines 41-100)"
        step_2: "Verify page loads fl-builder-grid.css via critical CSS"
        step_3: "Test grid layouts, equal-height columns, responsive behavior"

      phase_3_utility_removal:
        step_1: "Remove utility class duplicates (lines 101-200)"
        step_2: "Verify page loads _consolidated-utilities.css"
        step_3: "Test margin/padding/display utilities"

      phase_4_component_evaluation:
        step_1: "Analyze component overrides (lines 201-500)"
        step_2: "Distinguish: Global component fix vs page-specific override"
        step_3: "Move global fixes to component files"
        step_4: "Preserve page-specific overrides in layout file"

      phase_5_page_specific_preservation:
        step_1: "Validate ALL .fl-node-* selectors preserved"
        step_2: "Document layout-critical CSS patterns"
        step_3: "Final screenshot validation with tolerance: 0.0"

    expected_impact:
      duplicates_eliminated: "100+ duplicate rule sets across 20+ page files"
      file_size_reduction: "~5KB per page √ó 20 files = 100KB total"
      visual_risk: "HIGH - page-specific CSS directly affects appearance"

    validation_protocol:
      micro_commit_strategy:
        - "Process ONE page file at a time"
        - "Process ONE layer at a time (foundation ‚Üí grid ‚Üí utilities ‚Üí components)"
        - "Commit after EACH layer removal"
        - "Test after EACH commit with bin/rake test:critical"
        - "Rollback immediately if visual regression detected"

      screenshot_validation:
        - "Capture baseline BEFORE touching page file"
        - "Compare screenshots AFTER each layer removal"
        - "Tolerance: 0.0 (ZERO tolerance for visual changes)"
        - "Manual visual inspection for layout integrity"

  blocklist_critical:
    # DO NOT TOUCH until critical CSS infrastructure created
    files_without_infrastructure:
      - 404.css                              # No 404-critical.html
      - 3114-layout.css                      # No blog-critical.html

    resolution_options:
      option_a_infrastructure:
        - "Create themes/beaver/layouts/partials/header/critical/404-critical.html"
        - "Create themes/beaver/layouts/partials/header/critical/blog-critical.html"
        - "Import base-foundation.css, fl-builder-grid.css in new critical partials"
        - "THEN proceed with duplicate removal from 404.css and 3114-layout.css"

      option_b_preserve:
        - "Keep 404.css and 3114-layout.css as-is with duplicates"
        - "Document as exception files with inline infrastructure"
        - "Accept technical debt until critical CSS refactor"

      option_c_inline_critical:
        - "Move critical CSS directly into 404.html template"
        - "Move critical CSS directly into blog list template"
        - "Eliminates need for separate 404.css file"

  critical_insight:
    "‚ö†Ô∏è HIGHEST RISK LAYER - previous consolidation failures occurred here.
    Strategy: Process LAST, after Layers 0-4 established.
    Approach: Micro-commits, ONE page at a time, ONE layer at a time.
    Validation: Screenshot Guardian with ABSOLUTE blocking authority."
```

---

## üó∫Ô∏è PRIORITIZED CONSOLIDATION ROADMAP

### **Week 1: Layer 0 + Layer 1 (FOUNDATIONS)**
```yaml
week_1_deliverables:
  layer_0_css_variables:
    task: "Audit and validate foundations/css-variables.css as single source of truth"
    files_affected: 1
    risk: "LOW"
    validation: "No visual changes - variables only"

  layer_1_base_foundation:
    task: "Create critical/base-foundation.css merging all foundation patterns"
    files_affected: 8
    duplicates_removed: "60+ rule sets (box-sizing, clearfix, sr-only)"
    file_size_reduction: "60KB total"
    risk: "LOW"
    validation: "Screenshot comparison tolerance: 0.0"

  critical_css_updates:
    task: "Update ALL critical CSS partials to @import base-foundation.css"
    files_affected: "10+ critical partials"
    validation: "Verify ALL pages load base-foundation.css"

  blocklist_resolution:
    task: "Create 404-critical.html and blog-critical.html infrastructure"
    files_created: 2
    impact: "Unblocks 404.css and 3114-layout.css consolidation"
```

### **Week 2: Layer 2 (UTILITIES) + Layer 4 (LAYOUTS)**
```yaml
week_2_deliverables:
  layer_2_utilities:
    task: "Audit utilities/ directory, eliminate inline utility duplicates"
    files_affected: 25
    duplicates_removed: "30+ utility definitions"
    file_size_reduction: "15KB total"
    risk: "LOW"
    validation: "Screenshot comparison tolerance: 0.0"

  layer_4_fl_builder_grid:
    task: "Establish utilities/fl-builder-grid.css as authoritative, remove duplicates"
    files_affected: 15
    duplicates_removed: "60+ grid rule sets"
    file_size_reduction: "80KB total"
    risk: "HIGH"
    validation: "Screenshot comparison tolerance: 0.0, test grid responsiveness"
```

### **Week 3: Layer 3 (COMPONENTS)**
```yaml
week_3_deliverables:
  layer_3_components:
    task: "Consolidate component pairs (base vs BEM vs migration)"
    files_affected: 30
    duplicates_removed: "20+ component definitions"
    file_size_reduction: "20KB total"
    risk: "MODERATE"
    validation: "Screenshot comparison tolerance: 0.01, test component interactivity"

  component_api_documentation:
    task: "Document component API (which classes each file provides)"
    deliverable: "components/COMPONENT_API.md"
```

### **Week 4-6: Layer 5 (PAGE-SPECIFIC) - MICRO-COMMIT STRATEGY**
```yaml
week_4_6_deliverables:
  layer_5_page_specific:
    task: "Systematically strip duplicates from page-specific files"
    approach: "ONE page at a time, ONE layer at a time"
    files_affected: 50+
    duplicates_removed: "100+ rule sets across 20+ files"
    file_size_reduction: "100KB total"
    risk: "HIGH"
    validation: "Screenshot comparison tolerance: 0.0, ABSOLUTE blocking authority"

  micro_commit_phases:
    phase_1: "Foundation removal (5-10 pages)"
    phase_2: "Grid removal (5-10 pages)"
    phase_3: "Utility removal (5-10 pages)"
    phase_4: "Component evaluation (5-10 pages)"
    phase_5: "Final validation (ALL pages)"

  blocklist_handling:
    - "Process 404.css ONLY after 404-critical.html created (Week 1)"
    - "Process 3114-layout.css ONLY after blog-critical.html created (Week 1)"
```

---

## üìä EXPECTED IMPACT SUMMARY

### **Duplication Elimination**
```yaml
total_duplicates_removed:
  layer_0: "Minimal (validation only)"
  layer_1: "60+ foundation rule sets"
  layer_2: "30+ utility definitions"
  layer_3: "20+ component definitions"
  layer_4: "60+ grid rule sets"
  layer_5: "100+ page-specific duplicates"
  total: "270+ duplicate rule sets eliminated"
```

### **File Size Reduction**
```yaml
total_file_size_reduction:
  layer_1: "60KB (foundation patterns)"
  layer_2: "15KB (utilities)"
  layer_3: "20KB (components)"
  layer_4: "80KB (layouts)"
  layer_5: "100KB (page-specific)"
  total: "275KB total reduction"
  percentage: "~40% of current CSS size"
```

### **Risk Assessment**
```yaml
risk_by_layer:
  layer_0: "LOW - variables have no visual impact"
  layer_1: "LOW - foundation patterns well-tested"
  layer_2: "LOW - atomic utilities, isolated changes"
  layer_3: "MODERATE - component changes affect multiple pages"
  layer_4: "HIGH - grid changes affect layout structure"
  layer_5: "HIGH - page-specific CSS directly affects appearance"

overall_risk_mitigation:
  - "TOP-DOWN approach ensures foundation before optimization"
  - "Micro-commit strategy after EACH change"
  - "Screenshot Guardian with ABSOLUTE blocking authority"
  - "Tolerance: 0.0 for refactoring (ZERO visual changes)"
  - "Four-eyes validation: Coder ‚Üí Reviewer ‚Üí Screenshot Guardian ‚Üí Tester"
```

---

## üéØ SUCCESS CRITERIA

### **Technical Metrics**
- ‚úÖ 270+ duplicate rule sets eliminated
- ‚úÖ 275KB total file size reduction
- ‚úÖ Single source of truth for foundation, grid, utilities, components
- ‚úÖ ALL pages load infrastructure via critical CSS

### **Quality Gates**
- ‚úÖ ZERO visual regressions (tolerance: 0.0 for refactoring)
- ‚úÖ bin/rake test:critical passes with 0 failures
- ‚úÖ Screenshot comparison shows 0% difference per page
- ‚úÖ Four-eyes approval from ALL agents (coder, reviewer, screenshot-guardian, tester)

### **Documentation**
- ‚úÖ Layer-by-layer consolidation complete
- ‚úÖ Component API documented
- ‚úÖ Blocklist resolution (404-critical.html, blog-critical.html created)
- ‚úÖ Consolidation patterns captured in memory namespaces

---

## üö® CRITICAL FAILURE PREVENTION

### **Learnings from Previous Incidents**
```yaml
incident_404_3114_visual_regression:
  root_cause: "Bottom-up consolidation removed foundation CSS before infrastructure loaded"
  symptom: "9.5% desktop / 15.4% mobile visual regression"
  pages_affected: "404 page, blog pages"

  prevention_protocol:
    - "TOP-DOWN approach: Foundation FIRST, page-specific LAST"
    - "Verify critical CSS infrastructure BEFORE removing duplicates"
    - "Create 404-critical.html and blog-critical.html FIRST (Week 1)"
    - "Blocklist 404.css and 3114-layout.css until infrastructure ready"
    - "Screenshot Guardian has ABSOLUTE blocking authority"
    - "Tolerance: 0.0 for refactoring (ZERO tolerance for visual changes)"
```

### **Mandatory Validation Protocol**
```yaml
pre_consolidation:
  - "Capture baseline screenshots for ALL affected pages"
  - "Document which pages load which CSS infrastructure"
  - "Verify critical CSS partials load foundation layers"

during_consolidation:
  - "Process ONE layer at a time"
  - "Process ONE page at a time (for Layer 5)"
  - "Commit after EACH change"
  - "Test after EACH commit with bin/rake test:critical"

post_consolidation:
  - "Screenshot comparison with tolerance: 0.0"
  - "Visual diff review by Screenshot Guardian"
  - "Four-eyes approval from ALL agents"
  - "Rollback immediately if ANY visual regression detected"
```

---

## üìù NEXT ACTIONS

### **Immediate (Week 1)**
1. ‚úÖ Review and approve this TOP-DOWN strategy
2. ‚úÖ Create critical/base-foundation.css merging foundation patterns
3. ‚úÖ Create 404-critical.html and blog-critical.html infrastructure
4. ‚úÖ Update ALL critical CSS partials to @import base-foundation.css
5. ‚úÖ Begin Layer 1 consolidation with micro-commits

### **Short-term (Week 2-3)**
1. ‚è≥ Complete Layer 2 (utilities) consolidation
2. ‚è≥ Complete Layer 4 (layouts/grid) consolidation
3. ‚è≥ Begin Layer 3 (components) consolidation

### **Medium-term (Week 4-6)**
1. ‚è≥ Begin Layer 5 (page-specific) consolidation
2. ‚è≥ Process ONE page at a time with micro-commits
3. ‚è≥ Final validation and documentation

---

**Strategy Approved By**: Architecture Expert (Autonomous Analysis)
**Review Required**: CSS Migration Team (Hugo Specialist, Visual Guardian, Refactor Pair)
**Coordination**: Memory namespace: `hugo/css/architecture-decisions/20251014T1430`
