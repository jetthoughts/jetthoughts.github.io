# Validation Checklist for CSS Component Simplification (ADR-0001)

**Document:** ADR-0001 Validation Checklist
**Date:** 2025-01-17
**Purpose:** Companion validation guide for atomic CSS refactoring steps
**Related:** [ADR-0001 CSS Component Simplification](./40.02-css-component-simplification-adr.md)

## Overview

This checklist ensures each atomic refactoring step maintains system stability and visual consistency during the CSS component simplification migration.

**Critical Rule:** Each step must change ≤3 lines and pass all validations before proceeding.

## 🔍 Pre-Refactoring Checks

### 1. Git State Validation
```bash
# ✅ REQUIRED: Clean working state
git status --porcelain | wc -l    # Must output: 0
git branch --show-current          # Confirm on feature branch
```

### 2. Baseline Capture
```bash
# ✅ REQUIRED: Create rollback point
git add -A && git commit -m "Pre-refactor checkpoint: [step-description]"

# ✅ REQUIRED: Capture current state
bin/test > baseline-test.log       # Baseline test results
bin/hugo-build > baseline-build.log   # Baseline build output
```

### 3. Visual Reference Screenshots
```bash
# ✅ REQUIRED: Start development server
bin/hugo-dev &
SERVER_PID=$!
sleep 5

# ✅ REQUIRED: Manual screenshot capture
# Take screenshots of these key pages:
# - http://localhost:1313/ (Homepage)
# - http://localhost:1313/about/ (About page)
# - http://localhost:1313/services/ (Services page)
# Save as: screenshots/before-step-[N]/[page].png

# ✅ REQUIRED: Stop server
kill $SERVER_PID
```

### 4. Change Scope Validation
```bash
# ✅ REQUIRED: Verify atomic step size
echo "Planned changes should affect ≤3 lines total"
echo "If more than 3 lines needed, break into smaller steps"
```

## 🔄 During-Refactoring Validation

### 1. Line Count Enforcement
```bash
# ✅ REQUIRED: Monitor changes in real-time
git diff --numstat | awk '{sum+=$1+$2} END {print "Lines changed:", sum}'
# Must output: Lines changed: ≤3
```

### 2. Syntax Validation
```bash
# ✅ REQUIRED: Check CSS syntax (for CSS changes)
# Visual inspection of CSS syntax in editor
# Look for: missing semicolons, unmatched braces, typos

# ✅ REQUIRED: Check HTML syntax (for template changes)
# Visual inspection of HTML syntax in editor
# Look for: unclosed tags, malformed attributes, syntax errors
```

### 3. Build Validation (Immediate)
```bash
# ✅ REQUIRED: Test build after each change
bin/hugo-build 2>&1 | tee step-build.log
echo "Exit code: $?"              # Must be: 0

# ✅ REQUIRED: Check for build warnings
grep -i "warn\|error" step-build.log | wc -l    # Must be: 0
```

## ✅ Post-Refactoring Verification

### 1. Test Suite Validation
```bash
# ✅ REQUIRED: Full test suite
bin/test 2>&1 | tee step-test.log
echo "Test exit code: $?"         # Must be: 0

# ✅ REQUIRED: Compare with baseline
diff baseline-test.log step-test.log | head -10
echo "Tests should produce identical or better results"
```

### 2. Visual Regression Testing
```bash
# ✅ REQUIRED: Start development server
bin/hugo-dev &
SERVER_PID=$!
sleep 5

# ✅ REQUIRED: Manual visual comparison
# Navigate to same pages as pre-refactoring
# Compare against baseline screenshots
# Look for: layout shifts, missing elements, color changes, broken styles

# ✅ REQUIRED: Specific validation per change type
case "$CHANGE_TYPE" in
  "button")
    echo "Check: Button alignment, colors, hover states, text"
    ;;
  "grid")
    echo "Check: Layout structure, spacing, responsive behavior"
    ;;
  "css-removal")
    echo "Check: No missing styles, no layout breaks"
    ;;
esac

# ✅ REQUIRED: Stop server
kill $SERVER_PID
```

### 3. Performance Impact Check
```bash
# ✅ REQUIRED: Bundle size monitoring
du -sh themes/beaver/assets/css/ | tee step-css-size.txt
echo "CSS size should decrease or remain stable"

# ✅ REQUIRED: Build time monitoring (optional)
time bin/hugo-build 2>&1 | grep real
echo "Build time should not increase significantly"
```

### 4. Cross-Page Validation
```bash
# ✅ REQUIRED: Test key pages still load
curl -s http://localhost:1313/ > /dev/null && echo "Homepage: ✅"
curl -s http://localhost:1313/about/ > /dev/null && echo "About: ✅"
curl -s http://localhost:1313/services/ > /dev/null && echo "Services: ✅"
```

## 🚨 Rollback Procedures

### Immediate Rollback (Build Failures)
```bash
# ❌ EMERGENCY: If build fails immediately
git checkout HEAD -- [changed-file]
bin/hugo-build                     # Must succeed
echo "Rollback complete - investigate issue"
```

### Test Failure Rollback
```bash
# ❌ IF: Tests fail after change
git checkout HEAD -- [changed-file]
bin/test                           # Must pass
echo "Rollback complete - review test requirements"
```

### Visual Regression Rollback
```bash
# ❌ IF: Visual comparison shows problems
git checkout HEAD -- [changed-file]
bin/hugo-dev &
SERVER_PID=$!
sleep 5
# Re-verify visual correctness
kill $SERVER_PID
```

### Complete Step Rollback
```bash
# ❌ IF: Multiple issues or uncertainty
git reset --hard HEAD~1            # Back to pre-refactor checkpoint
bin/test && bin/hugo-build         # Verify clean state
echo "Full rollback complete - plan smaller step"
```

## 📋 Step-by-Step Validation Template

Copy this template for each atomic refactoring step:

```bash
#!/bin/bash
# STEP [N]: [Brief description]

echo "=== PRE-REFACTORING CHECKS ==="
# ✅ Git state clean
git status --porcelain | wc -l

# ✅ Create checkpoint
git add -A && git commit -m "Pre-refactor checkpoint: Step [N]"

# ✅ Baseline capture
bin/test > baseline-test.log
bin/hugo-build > baseline-build.log

# ✅ Screenshots captured manually
echo "Screenshots taken: before-step-[N]/"

echo "=== PERFORMING REFACTORING ==="
# [Make your ≤3 line changes here]

echo "=== POST-REFACTORING VALIDATION ==="
# ✅ Line count check
git diff --numstat | awk '{sum+=$1+$2} END {print "Lines changed:", sum}'

# ✅ Build validation
bin/hugo-build 2>&1 | tee step-build.log
echo "Build exit code: $?"

# ✅ Test validation
bin/test 2>&1 | tee step-test.log
echo "Test exit code: $?"

# ✅ Visual check reminder
echo "MANUAL STEP: Compare screenshots after-step-[N]/ with before-step-[N]/"
echo "MANUAL STEP: Start bin/hugo-dev and verify pages visually"

# ✅ CSS size check
du -sh themes/beaver/assets/css/ | tee step-css-size.txt

echo "=== VALIDATION COMPLETE ==="
echo "✅ All checks passed - ready for next step"
echo "❌ If any checks failed - run rollback procedure"
```

## 📊 Success Criteria

Each step must meet ALL criteria:

| Validation | Criteria | Command |
|------------|----------|---------|
| Build Status | Exit code 0 | `echo $?` after `bin/hugo-build` |
| Test Status | Exit code 0 | `echo $?` after `bin/test` |
| Line Changes | ≤3 lines | `git diff --numstat` |
| Visual State | No regressions | Manual screenshot comparison |
| CSS Size | Stable or reduced | `du -sh themes/beaver/assets/css/` |
| Page Loading | All key pages load | `curl` status checks |

## 🎯 Phase-Specific Validations

### Phase 1 (Inventory) - Documentation Only
- No validation needed (no code changes)
- Verify inventory documents are accurate

### Phase 2 (Style Consolidation) - CSS Changes
- **Extra emphasis on:** CSS syntax validation
- **Key check:** New styles don't break existing layouts
- **Rollback triggers:** Any visual changes in existing components

### Phase 3 (Template Migration) - HTML Changes
- **Extra emphasis on:** Visual regression testing
- **Key check:** New classes work alongside existing ones
- **Rollback triggers:** Layout shifts, missing elements

### Phase 4 (Dead Code Elimination) - Removal
- **Extra emphasis on:** Comprehensive page testing
- **Key check:** No missing styles after removal
- **Rollback triggers:** Any visual or functional breakage

## ⚠️ Common Pitfalls

1. **Skip screenshot comparison** → Visual regressions go unnoticed
2. **Rush through test validation** → Functional breaks missed
3. **Change too many lines** → Difficult to isolate issues
4. **Skip baseline capture** → No rollback reference
5. **Ignore build warnings** → Future problems accumulate

## 📞 Escalation

If validation fails repeatedly:
1. **Review step scope** - Break into smaller atomic changes
2. **Consult ADR-0001** - Ensure following prescribed approach
3. **Check dependencies** - Verify development environment setup
4. **Document issues** - Update ADR with lessons learned

---

**Remember:** This checklist is your safety net. Every ✅ check prevents production issues and maintains system stability during the refactoring process.